var Slider=function(a){var b=function(a){this.conf=this._extends({wrapId:"slider",itemClass:"slider_item",sameSize:!0,startOn:0,scrollBy:1,speed:6,isVertical:!1,isLoop:!0,autoPlay:!0,autoInterval:3,absoluteAni:!1,onReady:function(a){},onAniStart:function(a,b){},onAniEnd:function(a,b){},onEdge:function(a){}},a);this._initDoms();this._initStates();this._initEvents();this._launch()};b.prototype={_id:function(a){return document.getElementById(a)},_class:function(a,b,c){var d=[],e,f,g;b==null&&(b=document.body);c==null&&(c="*");if(b.getElementsByClassName)return b.getElementsByClassName(a);if(b.querySelectorAll)return b.querySelectorAll("."+a);e=b.getElementsByTagName(c);f=e.length;g=new RegExp("(^|\\s)"+a+"(\\s|$)");for(i=0,j=0;i<f;i++)if(g.test(e[i].className)){d[j]=e[i];j++}return d},_extends:function(a,b){for(property in b)a[property]=b[property];return a},_prefix:function(){function d(a){if(c==="")return a;a=a.charAt(0).toUpperCase()+a.substr(1);return c+a}var a;if(this.css3Key)return this.css3Key;var b=document.createElement("div").style,c=function(){var a="t,webkitT,MozT,msT,OT".split(","),c,d=0,e=a.length;for(;d<e;d++){c=a[d]+"ransform";if(c in b)return c=="msTransform"?!1:a[d].substr(0,a[d].length-1)}return!1}();a=c==""?"transitionend":c+"TransitionEnd";this.css3Key={support:typeof c=="boolean"?!1:!0,vendor:c,cssVendor:c?"-"+c.toLowerCase()+"-":"",transform:d("transform"),transition:d("transition"),transitionProperty:d("transitionProperty"),transitionDuration:d("transitionDuration"),transformOrigin:d("transformOrigin"),transitionTimingFunction:d("transitionTimingFunction"),transitionDelay:d("transitionDelay"),transitionEnd:a};return this.css3Key},_easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},_addEvent:function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},_initDoms:function(a){var b=this,c=this.conf,d=b._id(c.wrapId),e=d.innerHTML,f,g,h;c.isLoop?f='					<div style="'+(c.isVertical?"height":"width")+':30000px;zoom:1;">						<div style="float:left;">'+e+'</div>						<div style="float:left;">'+e+"</div>					</div>":f='<div style="'+(c.isVertical?"height":"width")+':30000px;zoom:1;">'+e+"</div>";d.innerHTML=f;g=d.getElementsByTagName("div")[0];g.style.position="relative";h=this._class(c.itemClass,d,"div");for(var i=0,j=h.length;i<j;i++)h[i].style["float"]=c.isVertical?"none":"left";this.doms={wrap:d,aniWrap:g,items:h,oInnerHTML:e}},_initStates:function(a){var b=this,c=this.conf,d=this.doms,e=d.items,f=this._prefix(),g,h,i,j,k,l,m,n,o,p,q,r;i=c.isVertical?"v":"h";k=c.isVertical?d.wrap.clientHeight:d.wrap.clientWidth;j=c.scrollDis?c.isLoop?Math.ceil(d.wrap.getElementsByTagName("div")[0].clientWidth*2/c.scrollDis):Math.ceil(d.wrap.getElementsByTagName("div")[0].clientWidth)/c.scrollDis:e.length;l=c.speed/10;g=d.wrap.clientWidth*c.scrollBy;m="touchstart"in window;n=c.isVertical?c.absoluteAni?"top":"marginTop":c.absoluteAni?"left":"marginLeft";f.vendor==""?q="transform "+l+"s ease-out":f.vendor&&(q="-"+f.vendor+"-transform "+l+"s ease-out");r=function(){var a=b.conf,c=b.doms,d=b.states,e=b._prefix();a.onAniEnd&&a.onAniEnd.call(b);d.animating=!1;c.aniWrap.removeEventListener(e.transitionEnd,arguments.callee,!1)};this.states={curIndex:c.startOn,scrollType:i,wrapSize:k,total:j,scrollDis:g,duration:l,touchDev:m,cssProterty:n,to:null,now:0,fromPos:null,movedPos:null,animating:!1,transitionAni:q,onTransitionEnd:r}},_initEvents:function(a){var b=this,c=this.conf,d=this.doms,e=this.states,f=d.wrap;this._addEvent(f,"mouseover",function(){if(c.autoPlay){clearInterval(b._auto);b._auto=null}});this._addEvent(f,"mouseout",function(){c.autoPlay&&b.autoSlide()});if("ontouchstart"in window){this._addEvent(f,"touchstart",function(a){b._touchstart(a)});this._addEvent(f,"touchmove",function(a){b._touchmove(a)});this._addEvent(f,"touchend",function(a){b._touchend(a)})}},_launch:function(){var a=this.conf,b=this.doms,c=this.states;if(a.startOn){this._moveToEle(a.startOn);c.fromPos=-c.wrapSize*a.startOnPos}else if(a.startOnPos){this._moveByPx(a.startOnPos,!0);c.fromPos=-a.startOnPos}a.onReady&&a.onReady.call(this);a.autoPlay&&this.autoSlide()},_touchstart:function(a){var b=this,c=this.conf,d=this.doms,e=this.states,f=this._prefix();if(a.touches.length!==1)return;if(c.isLoop){e.curIndex==0&&(e.curIndex+=e.total/2);e.curIndex==e.total-1&&(e.curIndex-=e.total/2);d.aniWrap.style[f.transition]="all 0s ease-out";this._moveToEle(e.curIndex)}clearInterval(this._auto);this._auto=null;this.touchInitPos=a.touches[0].pageX;this.touchInitPosY=a.touches[0].pageY;this.deltaX1=this.touchInitPos;this.startPos=-e.curIndex*e.scrollDis;e.touched=!0},_touchmove:function(a){var b=this,c=this.conf,d=this.doms,e=this.states,f=this._prefix(),g;if(a.touches.length!==1)return;var h=a.touches[0].pageX,i=a.touches[0].pageY,j=h-this.touchInitPos,k=i-this.touchInitPosY;(Math.abs(k)===0||Math.abs(j)/Math.abs(k)>=1)&&a.preventDefault();this.deltaX2=h-this.deltaX1;var g=this.startPos+j,l=g+"px,0",m=c.isVertical?"translate3d(0,"+g+"px,0)":"translate3d("+g+"px,0,0)";d.aniWrap.style[f.transform]="translate3d("+l+", 0)"},_touchend:function(a){var b=this,c=this.conf,d=this.doms,e=this.states,f=this._prefix(),g;if(this.deltaX2<-30){this.next();this.deltaX2=0}else if(this.deltaX2>30){this.prev();this.deltaX2=0}else this._slideToCss3(e.curIndex);e.touched=!1},_moveToEle:function(a,b,c){var d=this,e=this.conf,f=this.doms,g=this.states,h=g.curIndex,i=b?h+a:a,j=f.aniWrap,k=f.items,l=k[i],m=this._prefix(),n,o;a!=h&&e.onIndexChanged&&e.onIndexChanged.call(this,a);n=e.isVertical?-l.offsetTop:-l.offsetLeft;o=e.isVertical?"translate3d(0,"+n+"px,0)":"translate3d("+n+"px,0,0)";if(m.vendor!==!1){g.animating&&j.removeEventListener(m.transitionEnd,g.onTransitionEnd,!1);j.style[m.transition]="all 0s ease-out";j.style[m.transform]=o;g.curIndex=i;setTimeout(function(){c&&c.call(d)},20)}else{j.style[g.cssProterty]=n+"px";g.curIndex=a;c&&c.call(this)}},_slideToCss3:function(a){var b=this,c=this.conf,d=this.doms,e=this.states,f=d.items,g=d.aniWrap,h=this._prefix(),i,j;g.style[h.transition]=e.transitionAni;i=c.isVertical?-f[a].offsetTop:-f[a].offsetLeft;j=c.isVertical?"translate3d(0,"+i+"px,0)":"translate3d("+i+"px,0,0)";g.style[h.transform]=j;e.animating&&g.removeEventListener(h.transitionEnd,e.onTransitionEnd,!1);g.style[h.transform]=j;g.addEventListener(h.transitionEnd,e.onTransitionEnd,!1);e.curIndex=a},_slideToTdt:function(a){var b=this,c=this.conf,d=this.doms,e=this.states,f=d.aniWrap,g=e.cssProterty,h=e.duration*1e3,i=e.now,j=e.wrapSize,k;if(e.to===null||e.to==a)e.fromPos=-e.curIndex*j;else{e.fromPos=e.movedPos;e.now=0}if(h-i<20){f.style[g]=-a*j+"px";e.curIndex=a;clearTimeout(this.aniInterval);this.aniInterval=null;e.now=0;e.to=null;e.fromPos=-e.curIndex*j;e.movedPos=null;c.onAniEnd&&c.onAniEnd.call(this);e.animating=!1;return}k=this._easeOut(i,e.fromPos,-a*j-e.fromPos,h);f.style[g]=k+"px";e.now+=20;e.movedPos=k;this.aniInterval=setTimeout(function(){b._slideToTdt(a)},20)},prev:function(){var a=this.conf,b=this.doms,c=this.states,d=c.curIndex,e;if(a.isLoop&&d==0)this._moveToEle(c.total/2,!1,function(){e=c.curIndex-a.scrollBy;this.slideTo(e)});else{e=c.curIndex-a.scrollBy;this.slideTo(e)}},next:function(){var a=this.conf,b=this.doms,c=this.states,d=c.curIndex,e;if(a.isLoop&&d==c.total-1)this._moveToEle(c.total/2-1,!1,function(){e=c.curIndex+a.scrollBy;this.slideTo(e)});else{e=c.curIndex+a.scrollBy;this.slideTo(e)}},slideByEle:function(a){var b=this.states.curIndex+a;this.slideTo(b)},slideTo:function(a){var b=this,c=this.conf,d=this.doms,e=this.states,f=e.curIndex,g=e.total,h=this._prefix(),i,j;i=a>g-1?a%g:a<0?g+a%g:a;if(i==f)return;c.onIndexChanged&&c.onIndexChanged.call(this,i);e.animating=!0;c.autoPlay&&this.autoSlide();c.onAniStart&&c.onAniStart.call(this);h.vendor!==!1?this._slideToCss3(i):this._slideToTdt(i)},autoSlide:function(){var a=this;if(this._auto){clearInterval(this._auto);this._auto=null}this._auto=setInterval(function(){a.next()},this.conf.autoInterval*1e3)},disableAuto:function(){if(this._auto){clearInterval(this._auto);this._auto=null}},insertItem:function(a){},refresh:function(a){var b=this,c=this.conf,d=this.doms,e=this.states,f=this._prefix(),g;g=a&&a.width?a.width:c.isVertical?d.wrap.clientHeight:d.wrap.clientWidth;e.scrollDis=g*c.scrollBy;e.animating&&e.onTransitionEnd();d.aniWrap.style[f.transition]="all 0s ease-out";this._moveToEle(e.curIndex)},destroy:function(){}};return b}();
