var ModalWindow=function(a){this.config={title:"",size:{width:500,height:200},mode:"normal",posrefer:window,pos:{top:"middle",left:"center"},content:{type:"html",value:""},maskstyle:{color:"#545454",opacity:.5},showmask:!0,showhandle:!0,zindex:3e4,scrolling:!1,elements:"object,embed,select",onshow:function(){},onhide:function(){},ondestroy:function(){}};this.config=arguments[0]?typeof arguments[0]=="object"?this._mergeConfig(this.config,a):a:this.config;this.isIE=document.all?!0:!1;this.isIE6=this.isIE&&!window.XMLHttpRequest;this.init()};ModalWindow.prototype={init:function(){this.status="hide";this.isDestroy=!1;this.dom={};this.dom.win=document.createElement("div");this.dom.win.className="ModalWindow";this.dom.winbox=document.createElement("div");this.dom.winbox.className="winbox";this.dom.winhead=document.createElement("div");this.dom.winhead.className="winhead";this.dom.wintitle=document.createElement("div");this.dom.wintitle.className="wintitle";this.dom.winclose=document.createElement("div");this.dom.winclose.className="winclose";this.dom.winCloseText=document.createTextNode("x");this.dom.winbody=document.createElement("div");this.dom.winbody.className="winbody";this.dom.winmask=document.createElement("div");this.dom.winmask.className="ModalWindow_mask";this.config.title&&this.setTitle(this.config.title).showTitle();this.config.size&&this.setSize(this.config.size.width,this.config.size.height);this.config.content&&this.setContent(this.config.content.type,this.config.content.value);this.config.mode=="fixed"&&this.setMode("fixed");this.config.showhandle&&this.showHandle();this.setMaskstyle(this.config.maskstyle.color,this.config.maskstyle.opacity);this.setElements(this.config.elements);this.setzIndex(this.config.zindex);this.dom.winhead.appendChild(this.dom.wintitle);this.dom.winhead.appendChild(this.dom.winclose);this.dom.winclose.appendChild(this.dom.winCloseText);this.dom.winbox.appendChild(this.dom.winhead);this.dom.winbox.appendChild(this.dom.winbody);this.dom.win.appendChild(this.dom.winbox);document.body.appendChild(this.dom.winmask);document.body.appendChild(this.dom.win);this.bind()},destroy:function(){if(this.isDestroy||!this.dom.win||!this.dom.winmask||!this.dom.win.parentNode||!this.dom.winmask.parentNode)return!1;this.isDestroy=!0;typeof this.config.ondestroy=="function"&&this.config.ondestroy();var a=this.dom.win.getElementsByTagName("iframe")[0];a&&a.parentNode.removeChild(a);this.dom.win.parentNode.removeChild(this.dom.win);this.dom.winmask.parentNode.removeChild(this.dom.winmask);return!0},bind:function(){var a=this;this.dom.winclose.onclick=function(){a.hide()};var b=function(){var b=a.getStatus();b=="show"&&a.rePos().resizeMask()};window.addEventListener?window.addEventListener("resize",function(){setTimeout(b,10)},!1):window.attachEvent&&window.attachEvent("onresize",function(){setTimeout(b,10)});return this},_setOpacity:function(a,b){if(!a)return!1;document.all?a.style.filter="alpha(opacity="+b*100+")":a.style.opacity=b;return!0},show:function(){var a=this.getPos();this.setPos(a.top,a.left);this.hideElements();this.isIE||this._setOpacity(this.dom.win,1);this.dom.win.style.visibility="visible";this.status="show";if(this.config.showmask){this.resizeMask();this.dom.winmask.style.display="block"}typeof this.config.onshow=="function"&&this.config.onshow();return this},hide:function(){this.showElements();this.isIE||this._setOpacity(this.dom.win,0);this.dom.win.style.visibility="hidden";this.dom.winmask.style.display="none";this.status="hide";typeof this.config.onhide=="function"&&this.config.onhide();return this},getStatus:function(){return this.status},toggle:function(){var a=this.getStatus();a=="show"?this.hide():a=="hide"&&this.show();return this},reload:function(){},clearContent:function(){var a=this.dom.win.getElementsByTagName("iframe")[0];a&&a.parentNode.removeChild(a);this.dom.winbody.innerHTML="";return this},setMode:function(a){var b="normal";a=="fixed"?b="fixed":b="normal";if(this.config.posrefer==window&&!this.isIE6){this.dom.win.style.position=b=="fixed"?"fixed":"absolute";this.config.mode=b;this.rePos()}return this},setContent:function(a,b){this.config.content.type=a;this.config.content.value=b;this.clearContent();if(a=="html"||a=="element"){if(a=="html")this.dom.winbody.innerHTML=b;else{if(!b)return!1;this.dom.winbody.appendChild(b)}this.config.scrolling?this.dom.winbody.style.overflow="auto":this.dom.winbody.style.overflow="hidden"}else if(a=="iframe"){this.dom.winbody.style.overflow="hidden";var c=document.createElement("iframe");c.frameBorder="0";c.scrolling=this.config.scrolling?"auto":"no";this.dom.winbody.appendChild(c);setTimeout(function(){c.src=b},10)}return this},setScrolling:function(a){if(this.config.scrolling!=a){this.config.scrolling=a;if(this.config.content.type=="iframe"){iframe=this.dom.winbody.getElementsByTagName("iframe")[0];if(iframe){this.dom.winbody.style.overflow="hidden";var b=document.createElement("iframe");b.frameBorder="0";b.scrolling=a?"auto":"no";b.src=this.config.content.value;iframe.parentNode.removeChild(iframe);this.dom.winbody.appendChild(b)}}else a?this.dom.winbody.style.overflow="auto":this.dom.winbody.style.overflow="hidden"}return this},getSize:function(){return this.config.size},getRealsize:function(){return{width:this.dom.win.scrollWidth,height:this.dom.win.scrollHeight}},setSize:function(a,b){var a=parseInt(a,10),b=parseInt(b,10);this.config.size.width=a;if(!isNaN(a)){this.dom.winbody.style.width=a+"px";this.dom.winhead.style.width=a+"px"}if(!isNaN(b)){this.config.size.height=b;this.dom.winbody.style.height=b+"px"}this.rePos();return this},getPos:function(){return this.config.pos},setPosrefer:function(a){if(!a)return!1;this.config.posrefer=a;this.rePos();return this},setPos:function(a,b){var c=0,d=0,e=this.config.posrefer!=window?isNaN(parseInt(a,10))?0:parseInt(a,10):a,f=this.config.posrefer!=window?isNaN(parseInt(b,10))?0:parseInt(b,10):b,g=this.getRealsize(),h=this.config.posrefer!=window?{width:this.config.posrefer.offsetWidth,height:this.config.posrefer.offsetHeight}:this._getClientRange(),i=this.config.posrefer!=window?this._getOffsetPos(this.config.posrefer):this.config.mode=="fixed"?{top:0,left:0}:this._getWindowScroll();a=="top"?e=i.top:a=="middle"?e=i.top+parseInt((h.height-g.height)/2):a=="bottom"?e=i.top+(h.height-g.height):e=i.top+parseInt(a,10);b=="left"?f=i.left:b=="center"?f=i.left+parseInt((h.width-g.width)/2):b=="right"?f=i.left+parseInt(h.width-g.width):f=i.left+parseInt(b,10);this.config.pos.top=a;this.config.pos.left=b;this.dom.win.style.top=e+"px";this.dom.win.style.left=f+"px";return this},rePos:function(){var a=this.getPos();this.setPos(a.top,a.left);return this},getTitle:function(){return this.config.title},setTitle:function(a){var a=a.toString();this.config.title=a;this.dom.wintitle.innerHTML=a;return this},showTitle:function(){this.dom.wintitle.style.display="block";this.rePos();return this},hideTitle:function(){this.dom.wintitle.style.display="none";this.rePos();return this},showHandle:function(){this.dom.winclose.style.display="block";return this},hideHandle:function(){this.dom.winclose.style.display="none";return this},showMask:function(){this.config.showmask=!0;if(this.status=="hide")return;this.resizeMask();this.dom.winmask.style.display="block";return this},hideMask:function(){this.dom.winmask.style.display="none";this.config.showmask=!1;return this},resizeMask:function(){var a=this._getScrollRange(),b=this._getClientRange(),c=b.height>a.height?b:a;this.dom.winmask.style.width=c.width+"px";this.dom.winmask.style.height=c.height+"px";return this},getElements:function(){return this.dom},setMaskstyle:function(a,b){this.config.maskstyle.color=a;this.config.maskstyle.opacity=b;this.dom.winmask.style.backgroundColor=a;document.all?this.dom.winmask.style.filter="alpha(opacity="+b*100+")":this.dom.winmask.style.opacity=b;return this},setzIndex:function(a){var a=parseInt(a,10);this.config.zindex=a;this.dom.win.style.zIndex=a;this.dom.winmask.style.zIndex=a;return this},getzIndex:function(){return this.config.zindex},setShowCallback:function(a){typeof a=="function"?this.config.onshow=a:this.config.onshow=function(){};return this},setHideCallback:function(a){typeof a=="function"?this.config.onhide=a:this.config.onhide=function(){};return this},setDestroyCallback:function(a){typeof a=="function"?this.config.ondestroy=a:this.config.ondestroy=function(){};return this},setElements:function(a){this.elements=null;a&&(this.config.elements=a.split(","));return this},showElements:function(){if(this.elements)for(var a=0,b=this.elements.length;a<b;a++){var c=this.elements[a];c.style.visibility="visible"}return this},hideElements:function(){this.elements=[];var a=this.config.elements;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=document.getElementsByTagName(d);for(var f=0,g=e.length;f<g;f++){var h=e[f];this.elements.push(h)}}for(var b=0,c=this.elements.length;b<c;b++){var h=this.elements[b];h.style.visibility="hidden"}return this},_getWindowScroll:function(){var a=document.documentElement.scrollTop||document.body.scrollTop,b=document.documentElement.scrollLeft||document.body.scrollLeft;return{top:a,left:b}},_getScrollRange:function(){var a=0,b=0;a=document.documentElement.scrollWidth||document.body.scrollWidth;b=document.documentElement.scrollHeight||document.body.scrollHeight;return{width:a,height:b}},_getClientRange:function(){var a=0,b=0;a=document.documentElement.clientWidth||document.body.clientWidth;b=document.documentElement.clientHeight||document.body.clientHeight;return{width:a,height:b}},_getOffsetPos:function(a){if(a.getBoundingClientRect){var b=0,c=0;try{var d=a.getBoundingClientRect(),e=document.documentElement;b=d.left+Math.max(e.scrollLeft,document.body.scrollLeft)-e.clientLeft;c=d.top+Math.max(e.scrollTop,document.body.scrollTop)-e.clientTop}catch(f){}return{top:c,left:b}}function g(a){try{return a.offsetParent?a.offsetLeft+g(a.offsetParent):a.offsetLeft}catch(b){return 0}}function h(a){try{return a.offsetParent?a.offsetTop+h(a.offsetParent):a.offsetTop}catch(b){return 0}}return{top:h(a),left:g(a)}},_mergeConfig:function(a,b,c){a=a||{};var d=typeof b,e=1,f;if(d==="undefined"||d==="boolean"){c=d==="boolean"?b:!1;b=a;a=this}typeof b!="object"&&Object.prototype.toString.call(b)!=="[object Function]"&&(b={});while(e<=2){f=e===1?a:b;if(f!=null)for(var g in f){var h=a[g],i=f[g];if(a===i)continue;c&&i&&typeof i=="object"&&!i.nodeType?a[g]=this.extend(h||(i.length!=null?[]:{}),i,c):i!==undefined&&(a[g]=i)}e++}return a}};
