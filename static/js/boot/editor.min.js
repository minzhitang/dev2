/*! app_index 15-10-2015 */
function qwery(){function a(){this.c={}}function b(a){return W.g(a)||W.s(a,"(^|\\s+)"+a+"(\\s+|$)",1)}function c(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c])}function d(a){for(var b=[],c=0,d=a.length;d>c;++c)p(a[c])?b=b.concat(a[c]):b[b.length]=a[c];return b}function e(a){for(var b=0,c=a.length,d=[];c>b;b++)d[b]=a[b];return d}function f(a){for(;(a=a.previousSibling)&&1!=a[C];);return a}function g(a){return a.match(U)}function h(a,c,d,e,f,g,h,i,k,l,m){var n,o,p,q,r;if(1!==this[C])return!1;if(c&&"*"!==c&&this[B]&&this[B].toLowerCase()!==c)return!1;if(d&&(o=d.match(D))&&o[1]!==this.id)return!1;if(d&&(r=d.match(E)))for(n=r.length;n--;)if(!b(r[n].slice(1)).test(this.className))return!1;if(k&&s.pseudos[k]&&!s.pseudos[k](this,m))return!1;if(e&&!h){q=this.attributes;for(p in q)if(Object.prototype.hasOwnProperty.call(q,p)&&(q[p].name||p)==f)return this}return e&&!j(g,_(this,f)||"",h)?!1:this}function i(a){return X.g(a)||X.s(a,a.replace(N,"\\$1"))}function j(a,b,c){switch(a){case"=":return b==c;case"^=":return b.match(Y.g("^="+c)||Y.s("^="+c,"^"+i(c),1));case"$=":return b.match(Y.g("$="+c)||Y.s("$="+c,i(c)+"$",1));case"*=":return b.match(Y.g(c)||Y.s(c,i(c),1));case"~=":return b.match(Y.g("~="+c)||Y.s("~="+c,"(?:^|\\s+)"+i(c)+"(?:\\s+|$)",1));case"|=":return b.match(Y.g("|="+c)||Y.s("|="+c,"^"+i(c)+"(-|$)",1))}return 0}function k(a,b){var d,e,f,i,j,k,l,n=[],o=[],p=b,q=Z.g(a)||Z.s(a,a.split(T)),s=a.match(S);if(!q.length)return n;if(i=(q=q.slice(0)).pop(),q.length&&(f=q[q.length-1].match(F))&&(p=r(b,f[1])),!p)return n;for(k=g(i),j=p!==b&&9!==p[C]&&s&&/^[+~]$/.test(s[s.length-1])?function(a){for(;p=p.nextSibling;)1==p[C]&&(k[1]?k[1]==p[B].toLowerCase():1)&&(a[a.length]=p);return a}([]):p[y](k[1]||"*"),d=0,e=j.length;e>d;d++)(l=h.apply(j[d],k))&&(n[n.length]=l);return q.length?(c(n,function(a){m(a,q,s)&&(o[o.length]=a)}),o):n}function l(a,b,c){if(n(b))return a==b;if(p(b))return!!~d(b).indexOf(a);for(var e,f,i=b.split(",");b=i.pop();)if(e=Z.g(b)||Z.s(b,b.split(T)),f=b.match(S),e=e.slice(0),h.apply(a,g(e.pop()))&&(!e.length||m(a,e,f,c)))return!0;return!1}function m(a,b,c,d){function e(a,d,i){for(;i=V[c[d]](i,a);)if(n(i)&&h.apply(i,g(b[d]))){if(!d)return i;if(f=e(i,d-1,i))return f}}var f;return(f=e(a,b.length-1,a))&&(!d||$(f,d))}function n(a,b){return a&&"object"==typeof a&&(b=a[C])&&(1==b||9==b)}function o(a){var b,c,d=[];a:for(b=0;b<a.length;++b){for(c=0;c<d.length;++c)if(d[c]==a[b])continue a;d[d.length]=a[b]}return d}function p(a){return"object"==typeof a&&isFinite(a.length)}function q(a){return a?"string"==typeof a?s(a)[0]:!a[C]&&p(a)?a[0]:a:v}function r(a,b,c){return 9===a[C]?a.getElementById(b):a.ownerDocument&&((c=a.ownerDocument.getElementById(b))&&$(c,a)&&c||!$(a,a.ownerDocument)&&u('[id="'+b+'"]',a)[0])}function s(a,b){var c,f,g=q(b);if(!g||!a)return[];if(a===window||n(a))return!b||a!==window&&n(g)&&$(a,g)?[a]:[];if(a&&p(a))return d(a);if(c=a.match(R)){if(c[1])return(f=r(g,c[1]))?[f]:[];if(c[2])return e(g[y](c[2]));if(aa&&c[3])return e(g[x](c[3]))}return u(a,g)}function t(a,b){return function(c){var d,e;return J.test(c)?void(9!==a[C]&&((e=d=a.getAttribute("id"))||a.setAttribute("id",e="__qwerymeupscotty"),c='[id="'+e+'"]'+c,b(a.parentNode||a,c,!0),d||a.removeAttribute("id"))):void(c.length&&b(a,c,!1))}}var u,v=document,w=v.documentElement,x="getElementsByClassName",y="getElementsByTagName",z="querySelectorAll",A="useNativeQSA",B="tagName",C="nodeType",D=/#([\w\-]+)/,E=/\.[\w\-]+/g,F=/^#([\w\-]+)$/,G=/^\.([\w\-]+)$/,H=/^([\w\-]+)$/,I=/^([\w]+)?\.([\w\-]+)$/,J=/(^|,)\s*[>~+]/,K=/^\s+|\s*([,\s\+\~>]|$)\s*/g,L=/[\s\>\+\~]/,M=/(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/,N=/([.*+?\^=!:${}()|\[\]\/\\])/g,O=/^(\*|[a-z0-9]+)?(?:([\.\#]+[\w\-\.#]+)?)/,P=/\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\]/,Q=/:([\w\-]+)(\(['"]?([^()]+)['"]?\))?/,R=new RegExp(F.source+"|"+H.source+"|"+G.source),S=new RegExp("("+L.source+")"+M.source,"g"),T=new RegExp(L.source+M.source),U=new RegExp(O.source+"("+P.source+")?("+Q.source+")?"),V={" ":function(a){return a&&a!==w&&a.parentNode},">":function(a,b){return a&&a.parentNode==b.parentNode&&a.parentNode},"~":function(a){return a&&a.previousSibling},"+":function(a,b,c,d){return a?(c=f(a))&&(d=f(b))&&c==d&&c:!1}};a.prototype={g:function(a){return this.c[a]||void 0},s:function(a,b,c){return b=c?new RegExp(b):b,this.c[a]=b}};var W=new a,X=new a,Y=new a,Z=new a,$="compareDocumentPosition"in w?function(a,b){return 16==(16&b.compareDocumentPosition(a))}:"contains"in w?function(a,b){return b=9===b[C]||b==window?w:b,b!==a&&b.contains(a)}:function(a,b){for(;a=a.parentNode;)if(a===b)return 1;return 0},_=function(){var a=v.createElement("p");return(a.innerHTML='<a href="#x">x</a>')&&"#x"!=a.firstChild.getAttribute("href")?function(a,b){return"class"===b?a.className:"href"===b||"src"===b?a.getAttribute(b,2):a.getAttribute(b)}:function(a,b){return a.getAttribute(b)}}(),aa=!!v[x],ba=v.querySelector&&v[z],ca=function(a,b){var d,f,g=[];try{return 9!==b[C]&&J.test(a)?(c(d=a.split(","),t(b,function(a,b){f=a[z](b),1==f.length?g[g.length]=f.item(0):f.length&&(g=g.concat(e(f)))})),d.length>1&&g.length>1?o(g):g):e(b[z](a))}catch(h){}return da(a,b)},da=function(a,d){var e,f,g,h,i,j,l=[];if(a=a.replace(K,"$1"),f=a.match(I)){for(i=b(f[2]),e=d[y](f[1]||"*"),g=0,h=e.length;h>g;g++)i.test(e[g].className)&&(l[l.length]=e[g]);return l}return c(j=a.split(","),t(d,function(a,b,c){for(i=k(b,a),g=0,h=i.length;h>g;g++)(9===a[C]||c||$(i[g],d))&&(l[l.length]=i[g])})),j.length>1&&l.length>1?o(l):l},ea=function(a){"undefined"!=typeof a[A]&&(u=a[A]&&ba?ca:da)};return ea({useNativeQSA:!0}),s.configure=ea,s.uniq=o,s.is=l,s.pseudos={},s}!function(a,b){[].indexOf||(Array.prototype.indexOf=function(a){for(var b,c=this,d=0,e=c.length;e>d;d++)if(b=c[d],b===a)return d;return-1});var c=[],d={noSpaceReg:/[^ \t\n\r\u200B\uFEFF]/,spaceChar:"\ufeff",editorId:0,create:function(a){var b=this,c=new b.Editor(a);return b.add(c),c},get:function(a){if("string"!=typeof a)return c[a];for(var b=0,d=c.length;d>b;b++)if(a===c[b].id)return c[b]},add:function(a){c.push(a)},regist:function(a,c){for(var d,e=a.split("."),f=this,g=this,h=0,i=e.length;i-1>h;h++)d=e[h],g[d]===b&&(g[d]={}),g=g[d];if(g[e[h]]!==b)throw Error(a+" is defined!");g[e[h]]=c.call(f,f)}};a.SinaEditor=d}(window),SinaEditor.regist("Util",function(SE){var Util={};return Util.inArray=function(a,b){var c=this.arrayIndexOf(a,b);return c>-1?!0:!1},Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},Util.toArray=function(a){var b=[];if(Util.isArray(a))return a;for(var c=0,d=a.length;d>c;c++)b.push(a[c]);return b},Util.isObject=function(a){return"[object Object]"===a.toString()},Util.bind=function(a,b){return function(){a.apply(b,arguments)}},Util.arrayIndexOf=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return c;return-1},Util.extend=function(a,b){var c=arguments;if(a=a||{},2==c.length)a=Util.mix(a,b);else for(var d=1,e=c.length;e>d;d++)a=Util.mix(a,c[d]);return a},Util.mix=function(a,b,c){for(var d in b)b.hasOwnProperty(d)&&(c&&a[d]&&Util.isObject(a[d])?Util.mix(a[d],b[d],c):a[d]=b[d]);return a},Util.merge=function(a,b,c,d){a||(a={});for(var e in b)d&&a[e]&&!Util.isObject(a[e])||b.hasOwnProperty(e)&&(c&&Util.isObject(b[e])?a[e]=Util.merge(a[e]||{},b[e],c,d):a[e]=b[e]);return a},Util.inherits=function(a,b,c){var d=a.prototype;c=c||{};var e=new Function;e.prototype=b.prototype;var f=new e;for(var g in d)f[g]=d[g];return Util.mix(f,c),a.prototype=f,f.constructor=a},Util.each=function(a,b){if(a){if("length"in a){for(var c,d=0,e=a.length;e>d&&(c=a[d],!1!==b.call(c,d,c,a));d++);return a}for(var f in a)if(a.hasOwnProperty(f)&&!1===b.call(a[f],f,a[f],a))break;return a}},Util.Deffer=function(a){var b={queue:[],then:function(a){return this.queue.push(a),this},next:function(){var a=this.queue.shift();a&&a.call(null,this)},start:function(){this.next()}};return a&&b.queue.push(a),b},Util.urlParser=function(a,b){var c=document.createElement("a");c.href=a;for(var d,e=c.search,f=e.replace("?",""),g=f.split("&"),h={},i=g.length-1;i>=0;i--)d=g[i].match(/([^=]+)(=(.*)){0,1}/),d&&d[1]&&(h[d[1]]=b?decodeURIComponent(d[3]):d[3]);var j=c.pathname;return"/"!==j.charAt(0)&&(j="/"+j),{hostname:c.hostname||location.hostname,protocol:c.protocol||"http:",port:parseInt(c.port||80),pathname:j,search:e,hash:c.hash,host:c.host||location.host,params:h,param:function(a,b){return"undefined"==typeof b?h[a]:(h[a]=b,this.search=e="?"+this.serialize(),b)},toString:function(){var a=this,b=a.protocol+"//"+a.hostname+(80!==a.port?":"+a.port:"")+a.pathname+a.search+a.hash;return b},serialize:function(){var a=[];for(var c in h)h.hasOwnProperty(c)&&(null==h[c]||""==h[c]?a.push(c+"="):a.push(c+"="+h[c]));var d=a.join("&");return b?encodeURIComponent(d):d}}},Util.trim=function(a){var b="	\n\f\r   ᠎             　\u2028\u2029\ufeff";b="["+b+"]";var c=new RegExp("^"+b+b+"*"),d=new RegExp(b+b+"*$");return a.replace(c,"").replace(d,"")},Util.uniqueId=function(){var a="SinaEditor_",b=0;return function(c){var d=+new Date;return(!1!==c?a+(c||""):"")+d+"_"+b++}}(),Util.ajax=function(){function createRequest(){var a=null;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=ActiveXObject("Microsoft.XMLHTTP")}catch(d){}}}return a}function request(a,b){return b=b||{},b.onComplete=b.onComplete||function(){},b.onException=b.onException||function(){},b.returnType=b.returnType||"txt",b.method=b.method||"get",b.data=b.data||{},"undefined"!=typeof b.GET&&"undefined"!=typeof b.GET.url_random&&0==b.GET.url_random&&(this.rand=!1,b.GET.url_random=null),loadData(a,b)}function loadData(url,option){var timer,request=createRequest(),tmpArr=[],_url=new Util.urlParser(url);if(option.POST)for(var postkey in option.POST){var postvalue=option.POST[postkey];null!=postvalue&&tmpArr.push(postkey+"="+encodeURIComponent(postvalue))}var sParameter=tmpArr.join("&")||"";if(option.GET)for(var key in option.GET)"url_random"!=key&&_url.param(key,encodeURIComponent(option.GET[key]));0==option.rand,request.onreadystatechange=function(){if(clearTimeout(timer),4==request.readyState){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if($IE)response=request.responseXML;else{var Dparser=new DOMParser;response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")")}option.onComplete(response)}catch(e){return option.onException(e.message,_url),!1}}};try{option.POST?(request.open("POST",_url,!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),request.send(sParameter)):(request.open("GET",_url,!0),request.send(null)),option.timeout&&option.onTimeout&&(timer=setTimeout(function(){onTimeout("请求超时",_url)},option.timeout))}catch(e){return clearTimeout(timer),option.onException(e.message,_url),!1}return request}return{request:request}},Util.unhtml=function(a){return a?a.replace(/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""},Util.unit2Pixel=function(a){if(!/(pt|cm)/.test(a))return a;var b;switch(a.replace(/([\d.]+)(\w+)/,function(c,d,e){a=d,b=e}),b){case"cm":a=25*parseFloat(a);break;case"pt":a=Math.round(96*parseFloat(a)/72)}return a+(a?"px":"")},Util}),SinaEditor.regist("VK",function(a){var b={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,COMMOND:91,modifierPressed:function(a){return a.shiftKey||a.ctrlKey||a.altKey},metaKeyPressed:function(b){return(a.env.mac?b.ctrlKey||b.metaKey:b.ctrlKey)&&!b.altKey}};return b}),SinaEditor.regist("env",function(a){function b(){var a,b=navigator.userAgent;(a=/msie (\d+\.\d+)/i.exec(b))?c.$msie=!0:/Trident\/\d+\.\d+;/i.exec(b)?(c.$msie=!0,a=/(?:rv:|MSIE)[ ]*(\d+\.{0,1}\d*)/i.exec(b)):(a=/firefox[\/\s](\d+\.\d+)/i.exec(b))?c.$firefox=!0:(a=/chrome\/(\S+) safari\/(?:\S+)/i.exec(b))?(c.$webkit=!0,c.$chrome=!0):(a=/safari\/(\S+)/i.exec(b))?(c.$webkit=!0,c.$safari=!0):(a=/opera[\/\s](\d+\.\d+)/i.exec(b))&&(c.$opera=!0),a&&(c.version=parseInt(a[1],10)),/Mac OS/.test(b)&&/Mac/.test(navigator.platform)&&(c.mac=!0),c.$msie&&c.version<7&&(c.$ie6=!0),c.$msie&&(c.$belowIe9=!1,c.version<9&&(c.$belowIe9=!0))}var c={mac:!1,version:0,$webkit:!1,$firefox:!1,$msie:!1,$safari:!1,$opera:!1,$ie6:!1,$belowIe9:void 0},d=navigator.userAgent;return b(d),c}),SinaEditor.regist("Event",function(a){var b=a.Util,c=function(){this.__Events={},this.__hasFire={}};return c.prototype={constructor:c,fire:function(a,b,c){b=b.toLowerCase();for(var d,e=this.__Events[b]||[],f=Array.prototype.slice.apply(arguments,[2]),g=0;g<e.length;g++){var h=e[g],i={};if("function"==typeof h){i.returnValue=!0,i.event=b,i.undo=!1;var j=f.concat([]);if(j.unshift(i),d===!1?h.apply(a||this,j):d=h.apply(a||this,j),i.undo===!0&&(this.__Events[b][g]=void 0,this.__Events[b].splice(g,1),g--),i.returnValue===!1)break}}return this.__hasFire[b]=arguments,d},bind:function(a,b,c){a=a.toLowerCase();for(var d=a.split(" "),e=0;e<d.length;e++){var f=d[e];if(this.__Events[f]||(this.__Events[f]=[]),c&&this.__hasFire[f]){if("function"==typeof b){var g={};g.returnValue=!0,g.event=f,g.undo=!1;var h=this.__hasFire[f][0]||this,i=this.__hasFire[f],j=[];i&&(j=Array.prototype.slice.apply(i,[2,i.length])),j.unshift(g),b.apply(h,j),g.undo!==!0&&this.__Events[f].unshift(b)}}else this.__Events[f].unshift(b)}},unbind:function(a,c){var d=this.__Events[a]||[],e=b.arrayIndexOf(d,c);e>-1&&d.splice(e,1)},on:function(a,b,c){return this.bind(a,b,c)},off:function(a,b){return this.unbind(evtName,b)}},c}),SinaEditor.regist("dtd",function(a){var b=a.Util,c=function(){function a(a){for(var b in a)a[b.toUpperCase()]=a[b];return a}var c=b.extend,d=a({isindex:1,fieldset:1}),e=a({input:1,button:1,select:1,textarea:1,label:1}),f=c(a({a:1}),e),g=c({iframe:1},f),h=a({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),i=a({ins:1,del:1,script:1,style:1}),j=c(a({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),i),k=c(a({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),j),l=c(a({p:1}),k),m=c(a({iframe:1}),k,e),n=a({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),o=c(a({a:0}),m),p=a({tr:1}),q=a({"#":1}),r=c(a({param:1}),n),s=c(a({form:1}),d,g,h,l),t=a({li:1,ol:1,ul:1}),u=a({style:1,script:1}),v=a({base:1,link:1,meta:1,title:1}),w=c(v,u),x=a({head:1,body:1}),y=a({html:1}),z=a({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),A=a({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return a({$nonBodyContent:c(y,x,v),$block:z,$inline:o,$inlineWithA:c(a({a:1}),o),$body:c(a({script:1,style:1}),z),$cdata:a({script:1,style:1}),$empty:A,$nonChild:a({iframe:1,textarea:1}),$listItem:a({dd:1,dt:1,li:1}),$list:a({ul:1,ol:1,dl:1}),$isNotEmpty:a({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:a({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:a({p:1,div:1}),$tableContent:a({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:a({pre:1,script:1,style:1,textarea:1}),html:x,head:w,style:q,script:q,body:s,base:{},link:{},meta:{},title:q,col:{},tr:a({td:1,th:1}),img:{},embed:{},colgroup:a({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:s,td:s,br:{},th:s,center:s,kbd:o,button:c(l,h),basefont:{},h5:o,h4:o,samp:o,h6:o,ol:t,h1:o,h3:o,option:q,h2:o,form:c(d,g,h,l),select:a({optgroup:1,option:1}),font:o,ins:o,menu:t,abbr:o,label:o,table:a({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:o,tfoot:p,cite:o,li:s,input:{},iframe:s,strong:o,textarea:q,noframes:s,big:o,small:o,span:a({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:o,dt:o,sub:o,optgroup:a({option:1}),param:{},bdo:o,"var":o,div:s,object:r,sup:o,dd:s,strike:o,area:{},dir:t,map:c(a({area:1,form:1,p:1}),d,i,h),applet:r,dl:a({dt:1,dd:1}),del:o,isindex:{},fieldset:c(a({legend:1}),n),thead:p,ul:t,acronym:o,b:o,a:c(a({a:1}),m),blockquote:c(a({td:1,tr:1,tbody:1,li:1}),s),caption:o,i:o,u:o,tbody:p,s:o,address:c(g,l),tt:o,legend:o,q:o,pre:c(j,f),p:c(a({a:1}),o),em:o,dfn:o})}();return c}),SinaEditor.regist("DOMUtil",function(a){function b(a,b,c){var e=this;e.doc=a||document,e.win=b||window,e.body=c||e.doc.body,e.dtd=d,e.qwery=qwery(),e.isBlock=function(a){return d.$block[a.nodeName.toLowerCase()]}}var c=a.Util,d=a.dtd,e=a.env,f=!!document.createElement("div").contains;return b.prototype={constructor:b,isIE:e.$msie,dtd:d,$:function(a,b){var b=b||this.body||this.doc;return this.qwery(a,b)},append:function(a,b){return b.appendChild(a)},getNodes:function(a,b){var c,b=b||this.body||this.doc,d=/^#([\w\-]+)$|^\.([\w\-]+)$|^([\w\-]+)|^([\[\w\-\]]+)$/;if(c=d.exec(a)){if(c[1])return this.doc.getElementById(c[1]);if(c[2])return this.__getByCls(c[2],b);if(c[3])return b.getElementsByTagName(c[3]);if(c[4])return this.__getByAttr(c[4],b)}},attr:function(a,b,c){if(!this.isNode(a)&&11!=a.nodeType)return void 0;if("undefined"==typeof c){switch(b){case"id":c=a.id;break;case"className":case"class":c=a.className;break;case"style":cssText=a.style.cssText;break;case"innerHTML":case"value":c=a[b];break;default:c=a.getAttribute&&a.getAttribute(b)}return c}switch(b){case"id":a.id=c;break;case"className":case"class":a.className=c;break;case"style":"string"==typeof c?a.style.cssText=a.style.cssText+";"+c:this.setStyle(a,c);break;case"innerHTML":a[b]=c;break;case"value":a.value=c;break;default:a.setAttribute(b,c)}return this},removeAttr:function(a,b){var d,e=this;d="length"in a?a:[a],e.each(d,function(a,d){c.isArray(b)||(b=[b]),e.each(b,function(a,b){d.removeAttribute(b)})})},attrs:function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.attr(a,c,b[c]);return this},setStyle:function(){var a=SinaEditor.env,b=a.$msie&&a.version<9,c=b?function(a,b){a.style.filter="alpha(opacity="+100*b+")",a.currentStyle&&a.currentStyle.hasLayout||(a.style.zoom=1)}:function(a,b){a.style.opacity=b};return function(a,b){var d=this;return"length"in a?d.each(a,function(a,c){d.setStyle(c,b)}):d.each(b,function(b,d){var e;if((e=b.split("-"))&&1<e.length){b=e[0];for(var f=1;f<e.length;f++)b+=e[f].charAt(0).toUpperCase()+e[f].substring(1)}switch(b){case"opacity":c(a,d);break;case"float":b="float";default:try{a.style[b]=d}catch(g){}}}),this}}(),getStyle:function(){var a=SinaEditor.env,b=a.$msie&&a.version<9,c=function(a){var b;if((b=a.split("-"))&&1<b.length){a=b[0];for(var c=1;c<b.length;c++)a+=b[c].charAt(0).toUpperCase()+b[c].substring(1)}return a};return b?function(a,b){var d,e,f=b;switch(b=c(b)){case"opacity":var g=100;try{g=a.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(h){try{g=a.filters("alpha").opacity}catch(h){}}d=g/100;break;case"float":b="styleFloat";default:var i=a.currentStyle?a.currentStyle[b]:null;d=a.style[b]||i}if(!d&&(e=a.style.cssText)){var j=new RegExp(f+":[ ]*([^;]+)","i");d=e.match(j),d=d?d[1]:void 0}return d}:function(a,b){var d=this;b=c(b),"float"==b&&(b="cssFloat");try{var e=d.doc.defaultView.getComputedStyle(a,"")}catch(f){}return a.style[b]||(e?e[b]:null)}}(),setCSSText:function(a,b){function c(a){return a=a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}if("object"==typeof b){var d=[],e=SinaEditor.env,f=e.$msie&&e.version<9;this.each(b,function(a,b){switch(a){case"styleFloat":case"cssFloat":a="float";break;case"opacity":f&&(a="filter",b="alpha(opacity="+100*b+")")}d.push(c(a),":",b,";")}),b=d.join("")}a.style.cssText=b},getStart:function(a){var b=a.startContainer,c=a.startOffset;return 1!==b.nodeType?b:b.childNodes.length>c?b.childNodes.item(c):b},getEnd:function(a){var b,c=a.endContainer;return 1===c.nodeType&&(b=c.childNodes[a.endOffset-1])?b:c},toArray:function(a){var b=[];if(this.isNode(a))b.push(a);else if("length"in a)for(var c=0,d=a.length;d>c;c++)b[c]=a[c];else for(var c in a)b[c]=a[c];return b},isNode:function(a){return a&&a.nodeName&&(1==a.nodeType||11==a.nodeType||3==a.nodeType)},__getByCls:function(a,b){var c,d=[],e=!!this.doc.getElementsByClassName;return e?b.getElementsByClassName(a):(c=b.getElementsByTagName("*"),this.each(c,function(b,c){c.className.indexOf(a)>=0&&d.push(c)},!0),d)},__getByAttr:function(a,b){var c,d=[];c=this.toArray(b.getElementsByTagName("*"));var e=e.replace(/\[|\]/g,"").split("=");return 1===e.length?this.each(c,function(a,b){b.getAttribute(e[0])&&d.push(b)}):2===e.length&&this.each(c,function(a,b){b.getAttribute(e[0])===e[1]&&d.push(b)}),d},getCommonAncestor:function(a,b){if(a&&b){if(a==b)return a;3==a.nodeType&&(a=a.parentNode),3==b.nodeType&&(b=b.parentNode);var c="compareDocumentPosition",d=16;for(f&&(c="contains",d=1);a;){if((a[c](b)&d)===d)return a;a=a.parentNode}return void 0}},treeWalker:function(a,b,c,d){var b=b||this.body||this.doc.body,e=function(a,b,c,d){var e=a,f=function(a,b,c,d,e,g){var h,i,j;if(g=g||function(a){return!!a},a){if(j=a[c],!e&&j)return!1!==g(j)?j:f(j,b,c,d,e,g);if(a!==b){if(h=a[d],h&&!1!==g(h))return h;for(;(i=a.parentNode)&&i!=b;){for(;h=i[d];){if(h&&!1!==g(h))return h;i=h}a=i}}}};this.current=function(){return e},this.next=function(a){var d=f(e,b,"firstChild","nextSibling",a,c);return d&&(e=d),d},this.prev=function(a){var d=f(e,b,"lastChild","previousSibling",a,c);return d&&(e=d),d}};return new e(a,b,c,d)},findAllTextNodes:function(a,b,c){function d(a,b,c){for(var d=a.current();d&&(3===d.nodeType&&c.push(d),b!=d);)d=a.next();return c}c=c||this.body;var e=this.treeWalker(a,c),f=[];return f=d(e,b,f),1===b.nodeType&&(e=this.treeWalker(b.firstChild,b),f=d(e,b,f)),f},addClass:function(a,b){return a&&b?(this.hasClass(a,b)||(a.className+=" "+b),a):!1},delClass:function(a,b){return a&&b?(this.hasClass(a,b)&&(a.className=c.trim(a.className.replace(b,""))),a):!1},hasClass:function(a,b){if(!a||!b)return!1;var c=new RegExp("(^|\\s+)"+b+"(\\s+|$)","g");return c.test(a.className)},each:function(a,b,c){if(a){if("length"in a){for(var d,e=0,f=a.length;f>e;e++)if(this.isNode(a[e])){if(d=b.call(a[e],e,a[e],a),!1===d)break;c?forEach(a[e].children,b,c):this.__emptyFun}else if(d=b.call(a[e],e,a[e],a),!1===d)break;return a}for(var g in a)a.hasOwnProperty(g)&&b.call(a[g],g,a[g],a);return a}},__emptyFun:function(){},contains:function(a,b){if(!a||!b)return!1;var c=this.getNodePosition(a,b);return!!(16&c)||0===c},isSpecificParent:function(a,b,c){var d,e,f,g=this;if(a&&b){for("string"==typeof b?b=b.split(","):void 0===b.length&&(b=this.toArray(b)),d=c&&1==a.nodeType?a:a.parentNode;d&&d!==this.body;){e=d.nodeName.toLowerCase();for(var h=0,i=b.length;i>h;h++){var j=b[h];if("string"==typeof j){if(f=b[h].toLowerCase(),f===e)return d}else if(g.isSameElement(j,d))return d}d=d.parentNode}return!1}},remove:function(a,b){if(!a.parentNode)return!1;if(b)for(;a.firstChild;)a.parentNode.insertBefore(a.firstChild,a);return a.parentNode.removeChild(a)},parentUntilBody:function(a){if(9==a.nodeType)return a;var b=a;if(b==this.body)return b;for(;b;){if(b==this.body)return b;b=b.parentNode}return null},prev:function(a){return this.__findNode(a,"previousSibling")},next:function(a){return this.__findNode(a,"nextSibling")},__findNode:function(a,b){for(var c=a[b];c&&1!==c.nodeType;)c=c[b];return c||null},createText:function(a){return this.doc.createTextNode(a)},createFragment:function(){return this.doc.createDocumentFragment()},setAttributes:function(a,b){var c=this;return c.each(b,function(b,d){c.attr(a,b,d)}),a},create:function(a,b,c){var d=this,e=d.doc.createElement(a);return b&&d.attrs(e,b),"string"==typeof c&&(e.innerHTML=c),e},createCSSClass:function(a,b){function c(){return g.getElementsByTagName("head")}var d,e,f,g=this.document;if(g.styleSheets&&(f=c(),0!=f.length)){if(g.styleSheets.length>0)for(i=0;i<g.styleSheets.length;i++)if(!g.styleSheets[i].disabled){var h=g.styleSheets[i].media;if(e=typeof h,"string"==e?(""==h||-1!=h.indexOf("screen"))&&(d=g.styleSheets[i]):"object"==e&&(""==h.mediaText||-1!=h.mediaText.indexOf("screen"))&&(d=g.styleSheets[i]),"undefined"!=typeof d)break}if("undefined"==typeof d){var j=g.createElement("style");for(j.type="text/css",f[0].appendChild(j),i=0;i<g.styleSheets.length;i++)g.styleSheets[i].disabled||(d=g.styleSheets[i]);var h=d.media;e=typeof h}if("string"==e){for(i=0;i<d.rules.length;i++)if(d.rules[i].selectorText.toLowerCase()==a.toLowerCase())return void(d.rules[i].style.cssText=b);d.addRule(a,b)}else if("object"==e){for(i=0;i<d.cssRules.length;i++)if(d.cssRules[i].selectorText.toLowerCase()==a.toLowerCase())return void(d.cssRules[i].style.cssText=b);d.insertRule(a+"{"+b+"}",0)}}},createElementByHTML:function(a){var b=this.doc.createElement("div");b.innerHTML=a;var c=this.createFragment();return this.each(b.childNodes,function(a,b){c.appendChild(b)}),b=null,c},getWin:function(a){return a=a||this.doc,a.defaultView||a.parentWindow},html:function(a,b){return a?void 0!=typeof b&&"string"==typeof b?(a.innerHTML=b,a):a.innerHTML:void 0},parents:function(a,b){for(var c=[],d="number"==typeof b,e=b===!0?a:a.parentNode;e&&e!=this.body;){if(d){if(0===b)return c;b--}c.push(e),e=e.parentNode}return c},splitText:function(a,b){var c=a.cloneNode(!1);return c.deleteData(b,a.length),a.deleteData(0,b),this.insertBefore(c,a),a},getIndexByChild:function(a){!!a&&!!a.parentNode;for(var b=a.parentNode,c=-1,d=b.childNodes,e=d.length-1;e>c&&a!==d[c];c++);return c},text:function(a,b){var c="string"==typeof b;return"textContent"in a?(c&&(a.textContent=b),a.textContent):(c&&(a.innerText=b),a.innerText)},on:function(a,b,d,e,f){if(!a)return this;var g=this,h=function(a){var c=b.split(" "),h="",i="addEventListener";i in a||(i="attachEvent",h="on"),e=e||!1,g.each(c,function(b,c){void 0===f?a[i](h+c,function(b){var c=g.fixEvent(b);d.call(a,c)},e):a[i](h+c,g.delegate(f,function(a){var b=g.fixEvent(a);d.call(this,b)},a))})};return c.isArray(a)||a.length&&a.item?g.each(a,function(a,b){h(b)}):h(a),this},delegate:function(a,b,c){var d=this,e=function(b,c){for(var e,f=d.$(a,c);b&&b!==c;b=b.parentNode)for(e=f.length;e--;)if(f[e]===b)return b};return function(a){var a=d.fixEvent(a),f=e(a.target,c);f&&b.apply(f,arguments)}},off:function(a,b,c){var d=b.split(" "),e="",f="removeEventListener";return f in a||(f="detachEvent",e="on"),this.each(d,function(b,d){a[f](e+d,c)}),this},fixEvent:function(b){return b=b||this.win.event,b.target||(b.target=b.srcElement),b.stopPropagation||(b.stopPropagation=function(){b.cancelBubble=!0}),b.preventDefault||(b.preventDefault=function(){b.returnValue=!1}),b.stop||(b.stop=function(){b.stopPropagation(),b.preventDefault()}),a.env.$msie&&9>a.env.version&&("mouseover"==b.type?b.relatedTarget=b.fromElement:"mouseout"==b.type&&(b.relatedTarget=b.toElement)),b},getPos:function(a){if(null!=a.parentNode&&null!=a.offsetParent&&"none"!=a.style.display||a==document.body){var b=null,c=[];a.ownerDocument;c=[a.offsetLeft,a.offsetTop],b=a.offsetParent;var d="absolute"==a.style.position;if(b!=a)for(;b;)c[0]+=b.offsetLeft,c[1]+=b.offsetTop,!d&&"absolute"==b.style.position&&(d=!0),b=b.offsetParent;for(b=a.parentNode;b.tagName&&!/^body|html$/i.test(b.tagName);)b.style.display.search(/^inline|table-row.*$/i)&&(c[0]-=b.scrollLeft,c[1]-=b.scrollTop),b=b.parentNode;return{left:c[0],top:c[1]}}return!1},getRect:function(a){var b=a.getBoundingClientRect();return"width"in b||(b={bottom:b.bottom,left:b.left,right:b.right,top:b.top,width:a.offsetWidth,height:a.offsetHeight}),b},insertBefore:function(a,b){var c=b.parentNode;return c.insertBefore(a,b)},insertAfter:function(a,b){var c=b.parentNode,d=b.nextSibling;return d?this.insertBefore(a,d):c.appendChild(a)},insertNode:function(a,b,c){var d=this;switch(c=c.toLowerCase()||"beforeend"){case"beforebegin":return d.insertBefore(a,b);case"afterbegin":return b.firstChild?d.insertBefore(a,b.firstChild):d.append(a,b);case"beforeend":return b.lastChild?d.insertAfter(a,b.lastChild):d.append(a,b);case"afterend":return d.insertAfter(a,b)}},filterNodeList:function(a,b,d){var e=[];if("function"!=typeof b){var f=b;b=function(a){return c.inArray(void 0!==f.length?f:f.split(" "),a.tagName.toLowerCase())}}return this.each(a,function(a,c){b(c)&&e.push(c)}),0==e.length?null:1!=e.length&&d?e:e[0]},getElementPath:function(a){var b=a.startContainer,c=a.startOffset;return 1==b.nodeType&&b.childNodes.length>0&&(b=b.childNodes[c]||b),this.parents(b,!0)},isSamePath:function(a,b){var c,d,e=a.length,f=b.length;if(e!=f)return!1;if(0===f||0==e)return!1;for(var g=!1,h=0;e>h;h++)if(c=a[h],d=b[h],3!=c.nodeType||3!=d.nodeType||d.nodeValue!=c.nodeValue){if(g=this.isSameElement(c,d),!g)return!1}else g=!0;return g},getFilterTreeDom:function(a,b,c,d,e){var f,b=b||this.body||this.doc,g=d&&a.firstChild;for(!g&&(g=a.nextSibling);!g&&(f=(f||a).parentNode);){if("BODY"==f.tagName||f==b||e&&!e(f))return null;g=f.nextSibling}return g&&c&&!c(g)?this.getFilterTreeDom(g,!1,c,d,e):g},isBookMarkTag:function(a){return a&&1==a.nodeType&&"SPAN"==a.tagName&&a.getAttribute("bookmarkTag")},isEmptyInlineElement:function(a){if(1!=a.nodeType||!d.$removeEmpty[a.tagName])return 0;for(a=a.firstChild;a;){if(this.isBookMarkTag(a))return 0;if(1==a.nodeType&&!this.isEmptyInlineElement(a)||3==a.nodeType&&SinaEditor.noSpaceReg.test(a.nodeValue))return 0;a=a.nextSibling}return 1},clearSpecialNode:function(a,b,c){function d(a,b){for(var c;a&&!e.isBookMarkTag(a)&&(e.isEmptyInlineElement(a)||!new RegExp(/[^\t\n\r\u200B\uFEFF]/.test(a.nodeValue)));)c=a[b],e.remove(a),a=c}var e=this;!b&&d(a.nextSibling,"nextSibling"),!c&&d(a.previousSibling,"previousSibling")},cssStyleToDomStyle:function(){var a=document.createElement("div").style,b={"float":void 0!=a.cssFloat?"cssFloat":void 0!=a.styleFloat?"styleFloat":"float"};return function(a){return b[a]||(b[a]=a.toLowerCase().replace(/-./g,function(a){return a.charAt(1).toUpperCase()}))}}(),getNodePosition:function(a,b){if(a===b)return 0;if(a.compareDocumentPosition)return a.compareDocumentPosition(b);var c,d=[a],e=[b];for(c=a;c=c.parentNode;){if(c===b)return 10;d.push(c)}for(c=b;c=c.parentNode;){if(c===a)return 20;e.push(c)}if(d.reverse(),e.reverse(),d[0]!==e[0])return 1;for(var f=-1;f++,d[f]===e[f];);for(a=d[f],b=e[f];a=a.nextSibling;)if(a===b)return 4;return 2},isSameStyle:function(a,b,d){var e=a.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),f=b.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(window.opera&&window.opera.version){if(e=a.style,f=b.style,e.length!=f.length)return!1;for(var g in e)if(!/^(\d+|csstext)$/i.test(g)&&e[g]!=f[g])return!1;return!0}if(!e||!f)return e==f;if(e=e.split(";"),f=f.split(";"),e.length!=f.length&&!d)return!1;for(var h,i=0;h=e[i++];)if(!c.inArray(f,h))return!1;return!0},isSameElement:function(a,b){var c=this.isIE;if(3==a.nodeType&&3==b.nodeType)return 3!==b.nodeType?!1:a!==b?!1:!0;if(a.tagName!=b.tagName)return!1;var d=a.attributes,e=b.attributes;if(!d||!d)return!1;if(!c&&d.length!=e.length)return!1;for(var f,g,h=0,i=0,j=0;f=d[j++];){if("style"==f.nodeName){if(f.specified&&h++,this.isSameStyle(a,b))continue;return!1}if(c){if(!f.specified)continue;h++,g=e.getNamedItem(f.nodeName)}else g=b.attributes[f.nodeName];if(!g.specified||f.value!=g.value)return!1}if(c){for(j=0;g=e[j++];)g.specified&&i++;
if(h!=i)return!1}return!0},trimWhiteTextNode:function(a){function b(b){for(var c;(c=a[b])&&3==c.nodeType&&!SinaEditor.noSpaceReg.test(c.nodeValue);)a.removeChild(c)}b("firstChild"),b("lastChild")},mergeSibling:function(a,b,c){function d(a,b,c){var d;if((d=c[a])&&!e.isBookMarkTag(d)&&1==d.nodeType&&e.isSameElement(c,d)){for(;d.firstChild;)"firstChild"==b?c.insertBefore(d.lastChild,c.firstChild):c.appendChild(d.firstChild);e.remove(d)}}var e=this;!b&&d("previousSibling","firstChild",a),!c&&d("nextSibling","lastChild",a)},mergeChild:function(a,b,c){for(var d,e=this,f=a.getElementsByTagName(a.tagName.toLowerCase()),g=0;d=f[g++];)if(d.parentNode&&!e.isBookMarkTag(d))if("span"!=d.tagName.toLowerCase()){if(e.isSameElement(a,d)){if(d.parentNode)for(;d&&d.firstChild;)d.parentNode.insertBefore(d.firstChild,d);e.remove(d)}}else{if(a===d.parentNode&&(e.trimWhiteTextNode(a),1==a.childNodes.length)){if(a.style.cssText=d.style.cssText+";"+a.style.cssText,d.parentNode)for(;d&&d.firstChild;)d.parentNode.insertBefore(d.firstChild,d);e.remove(d);continue}if(d.style.cssText=a.style.cssText+";"+d.style.cssText,c){var h=c.style;if(h){h=h.split(";");for(var i,j=0;i=h[j++];)d.style[e.cssStyleToDomStyle(i.split(":")[0])]=i.split(":")[1]}}if(e.isSameStyle(d,a)){if(d.parentNode)for(;d&&d.firstChild;)d.parentNode.insertBefore(d.firstChild,d);e.remove(d)}}},mergeToParent:function(a){for(var b=a.parentNode,c=this;b&&d.$removeEmpty[b.tagName];){if(b.tagName==a.tagName||"A"==b.tagName){if(c.trimWhiteTextNode(b),"SPAN"==b.tagName&&!c.isSameStyle(b,a)||"A"==b.tagName&&"SPAN"==a.tagName){if(b.childNodes.length>1||b!==a.parentNode){b=b.parentNode;continue}"A"!=b.tagName}if("A"!=b.tagName){if(b===a.parentNode){for(;a&&a.firstChild;)a.parentNode.insertBefore(a.firstChild,a);c.remove(a)}break}}b=b.parentNode}},copyAttrs:function(a,b){var c=this,d=b.style.cssText,e=a.attributes;if(e){if(SinaEditor.env.$msie&&SinaEditor.env.version<9){e=[];var f=a.outerHTML;f.replace(/\s+([a-z0-9]+)(=['"]?([^='"\s>]+)['"]?(?=>|\s+?))?/gi,function(a,b,c,d){"bookmarkTag"!=b&&"style"!=b&&e.push({nodeType:2,value:d,nodeName:b})})}if(0==e.length)return b;var g={};c.each(e,function(a,b){b&&2==b.nodeType&&(g[b.nodeName]=b.value)}),c.setAttributes(b,g)}return d&&c.setAttributes(b,{style:d}),b},removeToAllChilds:function(a,b){if(1==a.nodeType&&a.childNodes.length>0)for(;a.firstChild;)b.appendChild(a.firstChild);return b},mergeTextNode:function(a){function b(a,b){for(;a[b]&&3==a[b].nodeType;)"previousSibling"==b?a.insertData(0,a[b].nodeValue):a.appendData(a[b].nodeValue),c.remove(a[b])}if(3==a.nodeType){var c=this;return b(a,"previousSibling"),b(a,"nextSibling"),a}},hover:function(a,b,c,d){function e(a,b,c,d){var e=a.relatedTarget;try{if(e&&e!==g.doc&&!e.parentNode)return;for(;e&&e!==b;)e=e.parentNode;e!==b&&c.apply(b,[a,b])}catch(f){}}function f(a,b){var c;if(d){var e=g.$(d,a),f=g.parents(b,!0);g.each(e,function(a,b){return g.each(f,function(a,d){return d==b?(c=b,!1):void 0}),c?!1:void 0})}else c=a;return c}var g=this;return b&&g.on(a,"mouseover",function(c){c=g.fixEvent(c);var d=c.target,h=f(a,d);e(c,h,b,"enter")},!1,d),c&&g.on(a,"mouseout",function(b){b=g.fixEvent(b);var d=b.target,h=f(a,d);e(b,h,c,"leave")},!1,d),g},breakParent:function(a,b){var c,d,e,f=a,g=a;do{for(f=f.parentNode,d?(c=f.cloneNode(!1),c.appendChild(d),d=c,c=f.cloneNode(!1),c.appendChild(e),e=c):(d=f.cloneNode(!1),e=d.cloneNode(!1));c=g.previousSibling;)d.insertBefore(c,d.firstChild);for(;c=g.nextSibling;)e.appendChild(c);g=f}while(b!==f);return c=b.parentNode,c.insertBefore(d,b),c.insertBefore(e,b),c.insertBefore(a,e),this.remove(b),a},scrollTop:function(a){var b=this.doc;return void 0==a?b.body.scrollTop+b.documentElement.scrollTop:(b.documentElement.scrollTop=a,b.body.scrollTop=a,a)}},b}),SinaEditor.regist("Range",function(){function a(a,b){var c=this;c.domUtil=b.domUtil,c.editor=b,c.doc=a,c.collapsed=!0,c.bookmarkList=[],c.skipSign=b.holder}var b=SinaEditor,c=b.dtd,d=b.env,e=b.Util;return a.prototype={constructor:a,domUtil:null,doc:null,startContainer:null,startOffset:null,endContainer:null,endOffset:null,bookmarkList:[],collapsed:!0,collapse:function(a){var b=this;return a?(b.endContainer=b.startContainer,b.endOffset=b.startOffset):(b.startContainer=b.endContainer,b.startOffset=b.endOffset),b.collapsed=!0,b},cloneContents:function(){return this.__proccessContents(0)},deleteContents:function(){var a=this;return a.__proccessContents(1),a.select(!0),a},extractContents:function(){return this.__proccessContents(2)},cloneRange:function(b){var c=new a(this.doc,this.editor);return c.setStart(this.startContainer,this.startOffset),c.setEnd(this.endContainer,this.endOffset),c},equals:function(a){if(!a)return!1;var b=a.startContainer==this.startContainer&&a.startOffset==this.startOffset,c=a.endContainer==this.endContainer&&a.endOffset==this.endOffset;return b&&c},shrinkBoundary:function(a){function b(a){return 1==a.nodeType&&!e.domUtil.isBookMarkTag(a)&&!c.$empty[a.tagName]&&!c.$nonChild[a.tagName]}for(var d,e=this;1==e.startContainer.nodeType&&(d=e.startContainer.childNodes[e.startOffset])&&b(d);)e.setStart(d,0);if(e.collapsed&&e.collapse(!0),!a)for(;1==e.endContainer.nodeType&&e.endOffset>0&&(d=e.endContainer.childNodes[e.endOffset-1])&&b(d);)e.setEnd(d,d.childNodes.length)},removeNode:function(a){var b=this.domUtil,c=a.parentNode;if(c){if(!c||a==b.body)return this;var d=this.startContainer,e=this.startOffset,f=this.endContainer,g=this.endOffset,h=b.getIndexByChild(a);return c==d&&h<Math.min(e,d.childNodes.length-1)&&(this.startOffset-=1,d==f&&(this.endOffset-=1)),c==f&&f!=d&&h<Math.min(g,f.childNodes.length-1)&&(this.endOffset-=1),c.removeChild(a),a=c=null,this}},boundaryTxt:function(a){var b=this,c=a?"end":"start",d=b[c+"Container"],e=b[c+"Offset"],f="set"+c.replace(/^(\w)/,function(a){return a.toUpperCase()})+"After",g="set"+c.replace(/^(\w)/,function(a){return a.toUpperCase()})+"Before";if(3!=d.nodeType)return b;if(0===e)b[g](d);else if(e>=d.nodeValue.length)b[f](d);else{var h=b.domUtil.splitText(d,e);a?b.setEndAfter(d):d===b.endContainer?b.setEnd(h,b.endOffset-e):d.parentNode===b.endContainer&&b.endOffset++,b[g](h)}return b},insertNode:function(a){var b=this,c=b.startContainer,d=b.startOffset,e=(b.endContainer,b.endOffset,1),f=a;if(b.boundaryTxt(),c=b.startContainer,d=b.startOffset,11==a.nodeType){if(e=a.childNodes.length,0==e)return;f=a.firstChild}var g=c.childNodes[d];return g?c.insertBefore(a,g):c.appendChild(a),f.parentNode==b.endContainer&&(b.endOffset+=e),b.setStartAfter(f),b},boundaryToBlock:function(){var a,b,c=this.domUtil,d=this.doc.createTextNode(""),b=this.startContainer;for(1==b.nodeType?b.childNodes[this.startOffset]?a=b=b.childNodes[this.startOffset]:(b.appendChild(d),a=b=d):a=b;;){if(c.isBlock(b)){for(b=a;(a=b.previousSibling)&&!c.isBlock(a);)b=a;this.setStartBefore(b);break}a=b,b=b.parentNode}for(b=this.endContainer,1==b.nodeType?((a=b.childNodes[this.endOffset])?b.insertBefore(d,a):b.appendChild(d),a=b=d):a=b;;){if(c.isBlock(b)){for(b=a;(a=b.nextSibling)&&!c.isBlock(a);)b=a;this.setEndAfter(b);break}a=b,b=b.parentNode}d.parentNode===this.endContainer&&this.endOffset--,c.remove(d),this.fixBoundary()},getStart:function(){var a=this,b=a.startContainer,c=a.startOffset;return 3==b.nodeType&&b.nodeValue.length<=c&&(b=b.nextSibling||b.parentNode.nextSibling||b,c=0),1==b.nodeType&&b.childNodes.length>0&&(b=b.childNodes[c]||b.lastChild),b},getEnd:function(){var a=this,b=a.endContainer,c=a.endOffset;return 1==b.nodeType&&0!=c&&(b=b.childNodes[c]||b.lastChild),b},fixBoundary:function(){var a=this;if(!a.collapsed){for(;a.startContainer!=a.domUtil.body&&a.startOffset==a.startContainer[3==a.startContainer.nodeType?"nodeValue":"childNodes"].length&&a.startContainer[3==a.startContainer.nodeType?"nodeValue":"childNodes"].length;)a.setStartAfter(a.startContainer);for(;a.endContainer!=a.domUtil.body&&!a.endOffset&&a.endContainer[3==a.endContainer.nodeType?"nodeValue":"childNodes"].length;)a.setEndBefore(a.endContainer)}},insertInlineTag:function(a,b,d){var e=this;if(!e.collapsed){e.shrinkBoundary(),e.boundaryTxt(),e.boundaryTxt(!0);for(var e=this;0==e.startOffset;){var f=e.startContainer;if(1==f.nodeType&&e.domUtil.isBlock(f))break;if(f==e.domUtil.body)break;e.setStartBefore(f)}for(;e.endOffset==(3==e.endContainer.nodeType?e.endContainer.nodeValue.length:e.endContainer.childNodes.length);){var g=e.endContainer;if(1==g.nodeType&&e.domUtil.isBlock(g))break;if(g==e.domUtil.body)break;e.setEndAfter(g)}e.fixBoundary();for(var h,i=function(a){if("function"==typeof d&&!d(a))return!1;var b=a.textContent||a.innerText||"";return 1==a.nodeType?!a.getAttribute(e.skipSign)&&"br"!=a.tagName.toLowerCase()&&b.length>0:!!SinaEditor.noSpaceReg.test(a.nodeValue)&&!a.parentNode.getAttribute(e.skipSign)},j=e.createBookMark(),k=e.cloneRange(),f=j.start,g=j.end,l=e.domUtil.getFilterTreeDom(f,null,i,!1),m=[];l&&4&e.domUtil.getNodePosition(l,g);)if(3==l.nodeType||c[a][l.tagName]){k.setStartBefore(l);for(var n=l;n&&(3==n.nodeType||c[a][n.tagName])&&n!==g;)h=n,n=e.domUtil.getFilterTreeDom(n,null,null,1==n.nodeType,function(b){return c[a][b.tagName]});k.setEndAfter(h);var o=k.doc.createElement(a);e.domUtil.setAttributes(o,b);var p=k.extractContents();if(o.appendChild(p),m.push(o),k.insertNode(o),e.domUtil.mergeSibling(o),e.domUtil.clearSpecialNode(o),e.domUtil.mergeChild(o,a,b),l=e.domUtil.getFilterTreeDom(o,null,i,!1),e.domUtil.mergeToParent(o),n===g)break}else l=e.domUtil.getFilterTreeDom(l,null,i,!0);k=null;for(var q=0;q<m.length;q++)e.domUtil.mergeSibling(m[q]);e.removeBookMark(j),e.moveToTxtNode()}},removeInlineTag:function(a,b,c){"string"==typeof a&&(a=[a]);var d=this;if(!d.collapsed){d.fixBoundary();for(var f=d.startContainer,g=d.endContainer;;){if(1==f.nodeType){if(e.inArray(a,f.tagName.toLowerCase()))break;if(f==d.domUtil.body){f=null;break}}f=f.parentNode}for(;;){if(1==g.nodeType){if(e.inArray(a,g.tagName.toLowerCase()))break;if(g==d.domUtil.body){g=null;break}}g=g.parentNode}var h,i,j=d.createBookMark();f&&(i=d.cloneRange(),i.setEndBefore(j.start),i.setStartBefore(f),h=i.extractContents(),i.insertNode(h),d.domUtil.clearSpecialNode(f,!0),f.parentNode.insertBefore(j.start,f)),g&&(i=d.cloneRange(),i.setStartAfter(j.end),i.setEndAfter(g),h=i.extractContents(),i.insertNode(h),d.domUtil.clearSpecialNode(g,!1,!0),g.parentNode.insertBefore(j.end,g.nextSibling));for(var k,l=d.domUtil.getFilterTreeDom(j.start,null,b||function(a){return 1==a.nodeType&&!a.getAttribute(d.skipSign)});l&&l!==j.end;){if(k=d.domUtil.getFilterTreeDom(l,null,function(a){return 1==a.nodeType},!0),e.inArray(a,l.tagName.toLowerCase())&&l.parentNode){for(;l&&l.firstChild;)l.parentNode.insertBefore(l.firstChild,l);d.domUtil.remove(l)}l=k}d.removeBookMark(j),c?d.select():d.moveToTxtNode()}},selectNode:function(a){var b=this;return b.setStartBefore(a),b.setEndAfter(a),b.select(),b},select:function(a){function b(a,b){if(a.collapsed&&!b){var c=a.startContainer,d=c;if(1==c.nodeType&&(d=c.childNodes[a.startOffset]),!(3==c.nodeType&&a.startOffset||(d?d.previousSibling&&3==d.previousSibling.nodeType:c.lastChild&&3==c.lastChild.nodeType))){var e=a.doc.createTextNode(SinaEditor.spaceChar);a.insertNode(e),a.setStart(e,SinaEditor.env.$webkit?1:0),a.collapse(!0)}}return 1==a.startContainer.nodeType&&a.startContainer.childNodes.length<a.startOffset&&(a.startOffset=a.startContainer.childNodes.length),1==a.endContainer.nodeType&&a.endContainer.childNodes.length<a.endOffset&&(a.endOffset=a.endContainer.childNodes.length),3==a.startContainer.nodeType&&a.startContainer.nodeValue.length<a.startOffset&&(a.startOffset=a.startContainer.nodeValue.length),3==a.endContainer.nodeType&&a.endContainer.nodeValue.length<a.endOffset&&(a.endOffset=a.endContainer.nodeValue.length),a}var c=this,e=c.editor,f=c.domUtil,g=c.doc,h=c.domUtil.getWin(c.doc),i=g.activeElement;try{var j=f.scrollTop();if(d.$firefox&&e.body.focus)e.body.focus(),f.scrollTop(j);else if(!i||!f.contains(e.body,i)){h.focus();var k=f.scrollTop();j!==k&&f.scrollTop(j)}}catch(l){}var m=h.getSelection();if(m){m.removeAllRanges();var n=c.doc.createRange();!c.collapsed||3===c.startContainer.nodeType,b(this,a);try{n.setStart(c.startContainer,c.startOffset),n.setEnd(c.endContainer,c.endOffset),m.addRange(n)}catch(l){}}return this.editor.selection.saveNative(),c},setEnd:function(a,b){return this.relovseRange(a,b)},setEndAfter:function(a){return this.setEnd(a.parentNode,this.domUtil.getIndexByChild(a)+1)},setEndBefore:function(a){return this.setEnd(a.parentNode,this.domUtil.getIndexByChild(a))},setStart:function(a,b){this.relovseRange(a,b,!0)},setStartAfter:function(a){return this.setStart(a.parentNode,this.domUtil.getIndexByChild(a)+1)},setStartBefore:function(a){var b=this.domUtil.getIndexByChild(a);return this.setStart(a.parentNode,b)},getCommonAncestor:function(){var a=this.startContainer,b=this.endContainer;return a==b?a:this.domUtil.getCommonAncestor(a,b)},createBookMark:function(a){var b,d=this,e=null;d.endContainer,d.endOffset;b=d.doc.createElement("span"),b.style.display="none",b.setAttribute("bookmarkTag","range_bookmark_start_sign"),a&&(b.id="start_"+a),d.collapsed||(e=d.doc.createElement("span"),e.style.display="none",e.setAttribute("bookmarkTag","range_bookmark_end_sign"),a&&(e.id="end_"+a)),!c.$empty[d.startContainer.nodeName.toLocaleLowerCase()],d.insertNode(b),e?(d.collapse(!1),d.insertNode(e),d.setStartAfter(b),d.setEndBefore(e)):d.collapse(!0);var f={start:b,end:e};return this.bookmarkList.push(f),f},createBookMarkByClone:function(a){if(!this.editor.body.parentNode||1!=this.editor.body.parentNode.nodeType)return this;if(d.$msie&&9>d.version)return{content:this.editor.body.innerHTML,body:this.editor.body,bookmark:this.createBookMark(a),range:this,cloneRange:this};var b,c,e,f,g,h,i,j,k=this,l=k.startContainer,m=k.startOffset,n=k.endContainer,o=k.endOffset,p=k.domUtil;3==l.nodeType?(f=l.parentNode,b=f.getAttribute("id"),f.setAttribute("id","bookmark_for_clone_start"),h=p.getIndexByChild(l)):(j=l.getAttribute("id"),j&&(b=j),l.setAttribute("id","bookmark_for_clone_start")),k.collapsed||(3==n.nodeType?(g=n.parentNode,j=g.getAttribute("id"),c="bookmark_for_clone_start"==j?"":j,g.setAttribute("id","bookmark_for_clone_end"),i=p.getIndexByChild(n)):(j=n.getAttribute("id"),"bookmark_for_clone_start"!=j&&(c=j),n.setAttribute("id","bookmark_for_clone_end"))),e=this.editor.body.cloneNode(!0),this.editor.body.parentNode.insertBefore(e,this.editor.body),p.remove(this.editor.body);var q=k.cloneRange(),r=f||l;b?r.id=b:r.removeAttribute("id"),this.collapsed||(r=g||n,c?r.id=c:r.removeAttribute("id")),r=null;var s=this.doc.getElementById("bookmark_for_clone_start");if(!this.collapsed)var t=this.doc.getElementById("bookmark_for_clone_end");!s&&!this.collapsed&&(s=t),b?s.setAttribute("id",b):s.removeAttribute("id"),this.collapsed||(c?t.setAttribute("id",c):t.removeAttribute("id")),f&&(s=s.childNodes[h]),g&&(t=t.childNodes[i]),q.setStart(s,m),t&&!this.collapsed?q.setEnd(t,o):q.collapse(!0);var u,v=q.createBookMark(a);try{u=e.innerHTML}catch(w){}return g=f=null,{content:u,body:e,bookmark:v,range:k,cloneRange:k.cloneRange()}},removeBookMark:function(a){var b,c=this;if("string"==typeof a){if(b=a,a={start:this.doc.getElementById("start_"+b),end:this.doc.getElementById("end_"+b)},!a.start)return this}else if(void 0===a&&this.bookmarkList.length>0)a=this.bookmarkList.pop();else if(!a)return this;return c.setStartAfter(a.start),a.end?c.setEndBefore(a.end):c.collapse(!0),c.removeNode(a.start),a.end&&c.removeNode(a.end),a.start=a.end=null,this},moveToBookMarkByClone:function(a){var b=a.range,c=a.cloneRange;return d.$msie&&9>d.version?(this.moveToBookMark(a.bookmark),this):(a.body.parentNode.insertBefore(b.editor.body,a.body),b.domUtil.remove(a.body),a.body=null,a=null,b.setStart(c.startContainer,c.startOffset),b.setEnd(c.endContainer,c.endOffset),void b.select(!0))},moveToBookMark:function(a){this.removeBookMark(a).select(!0)},moveToTxtNode:function(a,b,c){var d,e,f=this.collapsed,g=this.domUtil,h=this.startContainer,i=this.endContainer,j=this.startOffset,k=this.endOffset;if(a){var l,m=this.getEnd(),n=function(a){return 3==a.nodeType&&SinaEditor.noSpaceReg.test(a.nodeValue)&&4&g.getNodePosition(a,m)||3==m.nodeType&&a==m},o=this.getStart();if(1==o.nodeType&&o==h&&j==o.nodeValue.length){var p=g.getFilterTreeDom(o,null,n,!0);p&&(h=o=p,j=0)}if(!n(o)||!n(m)){if(!n(o)){if(h=o,j=0,h=g.getFilterTreeDom(h,null,n,!0),!h)return this.collapse(!0),c||this.select(!0),this.__fixRange();j=0,l=h}if(this.collapsed)this.collapse(!0);else{l=h;for(var q=null;l;)q=l,l=g.getFilterTreeDom(l,null,n,!0);l=q,q=null,l&&m!=l&&(i=l,k=i.nodeValue.length)}}l=o=null}for(;3!=h.nodeType&&h.childNodes.length>0;)h.childNodes[j]?(h=h.childNodes[j],j=0):h.childNodes[j-1]?(h=h.childNodes[j-1],j=1==h.nodeType?h.childNodes.length:h.nodeValue.length):h.nextSibling?(h=h.nextSibling,j=0):(h=h.lastChild,j=h&&3==h.nodeType?h.nodeValue.length:h.childNodes.length);if(f){if(3==h.nodeType&&!b){for(;(d=h.previousSibling)&&3==h.previousSibling.nodeType;)j+=d.nodeValue.length,h.insertData(0,d.nodeValue),g.remove(d);for(;(e=h.nextSibling)&&3==h.nextSibling.nodeType;)h.appendData(e.nodeValue),g.remove(e)}return this.setStart(h,j),h=null,this.collapse(!0),c||this.select(!0),this.__fixRange()}for(;3!=i.nodeType&&i.childNodes.length;)i.childNodes[k]?(i=i.childNodes[k],k=0):(i=i.lastChild,k=3==i.nodeType?i.nodeValue.length:i.childNodes.length),i.previousSibling&&0==k&&(i=i.previousSibling,k=3==i.nodeType?i.nodeValue.length:i.childNodes.length);if(3==h.nodeType&&!b){for(var r=!1;(d=h.previousSibling)&&3==h.previousSibling.nodeType;)j+=d.nodeValue.length,h==i&&(k+=d.nodeValue.length),h.insertData(0,d.nodeValue),g.remove(d);for(;(e=h.nextSibling)&&3==h.nextSibling.nodeType;)e!=i||r||(i=h,k+=h.nodeValue.length,r=!0),h.appendData(e.nodeValue),g.remove(e)}if(3==i.nodeType&&i!=h){for(;(d=i.previousSibling)&&3==i.previousSibling.nodeType;)k+=d.nodeValue.length,i.insertData(0,d.nodeValue),g.remove(d);for(;(e=i.nextSibling)&&3==i.nextSibling.nodeType;)i.appendData(e.nodeValue),g.remove(e)}return this.setStart(h,j),this.setEnd(i,k),c?this.editor.selection.saveW3CInfo&&this.editor.selection.saveW3CInfo(this):this.select(),h=i=d=e=null,this.__fixRange()},surroundContents:function(){},collapseUpdate:function(){var a=this;a.collapsed=a.startContainer&&a.endContainer&&a.startContainer===a.endContainer&&a.startOffset==a.endOffset},relovseRange:function(a,b,c){var d=c?"start":"end",e=c?"end":"start",f=this;return f[d+"Container"]=a,f[d+"Offset"]=b,f[e+"Container"]||f.collapse(c),f.collapseUpdate(),f},__proccessContents:function(a){function b(){return h.doc.createDocumentFragment()}function c(a){return 3===a.nodeType?a.nodeValue.length:a.childNodes.length}var d,e,f,g,h=this,i=b(),j=h.startContainer,k=h.endContainer,l=h.startOffset,m=h.endOffset,n=h.domUtil;if(this.collapsed)return i;if(1===j.nodeType&&(g=j.childNodes[l],g||(d=n.createText("[start]"),j.appendChild(d)),l=0,j=g||d),1===k.nodeType&&(g=k.childNodes[m-1],g||(e=n.createText("[end]"),k.firstChild?k.insertBefore(e,k.firstChild):k.appendChild(e)),k=g||e,m=c(k)),g=null,j==k)return 3==j.nodeType?(f=j.nodeValue,a&&0==l&&f.length==m?(g=j,h.setStartBefore(j)):(f=f.slice(l,m),g=n.createText(f),a&&(j.deleteData(l,m-l),h.setStart(j,l))),a&&h.collapse(!0),i.appendChild(g),i):(g=a?j:j.cloneNode(!0),a&&(h.setStartBefore(j),h.collapse(!0)),i.appendChild(g),i);for(var o,p,q,r=n.parents(j,!0).reverse(),s=n.parents(k,!0).reverse(),t=i,u=0;r[u]==s[u];)u++;for(var v,w=u;v=r[w];w++){for(o=v.nextSibling,v==j?d||(3==h.startContainer.nodeType?(f=j.nodeValue,a&&0==l?(h.setStartBefore(j),t.appendChild(j)):(p=f.length,f=f.slice(l,p),t.appendChild(n.createText(f)),a&&(j.deleteData(l,p-l),h.setStart(j,l)))):(h.setStartBefore(j),t.appendChild(a?j:j.cloneNode(!0)))):(q=v.cloneNode(!1),t.appendChild(q));o&&o!==k&&o!==s[w];)v=o.nextSibling,t.appendChild(a?o:o.cloneNode(!0)),o=v;t=q}t=i,r[u]||(t.appendChild(r[u-1].cloneNode(!1)),t=t.firstChild);for(var x,y=k.nextSibling,z=k.parentNode,w=u;x=s[w];w++){if(o=x.previousSibling,x==k?e||(3==h.endContainer.nodeType?(f=k.nodeValue,p=f.length,a&&p==m?t.appendChild(k):(f=f.slice(0,m),t.appendChild(n.createText(f)),a&&k.deleteData(0,m))):t.appendChild(a?k:k.cloneNode(!0))):(q=x.cloneNode(!1),t.appendChild(q)),w!=u||!r[u])for(;o&&o!==j;)x=o.previousSibling,t.insertBefore(a?o:o.cloneNode(!0),t.firstChild),o=x;t=q}return s[u]||(g=s[u-1].cloneNode(!1),g.appendChild(t),i=b(),i.appendChild(g)),a&&(s[u]?r[u]?y?(h.setEndBefore(y),h.collapse()):(z===h.editor.body||3==k.nodeType?h.setEnd(z,z.childNodes.length):h.setEndAfter(z),h.collapse()):(h.setStartBefore(r[u-1]),h.collapse(!0)):(h.setEndAfter(s[u-1]),h.collapse())),d&&n.remove(d),e&&n.remove(e),i},scrollToCursor:function(a){var b=this.createBookMark("getY");b.start.style.display="inline-block";var c=this.domUtil.getPos(b.start).top+(a||-300);return this.moveToBookMark("getY"),c<this.doc.body.scrollTop&&(this.doc.body.scrollTop=c),c},clearFillChar:function(){for(var a=this.startContainer;a=this.domUtil.getFilterTreeDom(a,null,function(a){return 3==a.nodeType&&!SinaEditor.noSpaceReg.test(a.nodeValue)})&&a!=this.endContainer;)range.removeNode(a)},__fixRange:function(a){return a=a||this,c.$empty[a.startContainer.nodeName.toLowerCase()]&&a.setStartBefore(a.startContainer),c.$empty[a.endContainer.nodeName.toLowerCase()]&&a.setEndAfter(a.startContainer),a}},a}),SinaEditor.regist("Selection",function(a){function b(a,b){var c=this;c.doc=a,c.editor=b,c.domUtil=b.domUtil,c.__cachedRange=c.__cachedStart=null,c.__lastRange=null}var c=a.Range;a.Util,a.DOMUtil;return b.prototype={createRange:function(){var a=new c(this.doc,this.editor);return a},getTrueRange:function(a,b){var d,e=this,f=e.getNative();if(d=f&&f.rangeCount>0?a||f.getRangeAt(0):a,!d||!d.startContainer)return null;var b=b||new c(e.doc,e.editor);d.startContainer.parentNode==d.endContainer&&!d.startOffset&&d.setStart(d.endContainer,d.endoffset-1);var g=d.commonAncestorContainer;!g&&d.getCommonAncestor&&(g=d.getCommonAncestor());var h=e.editor.body;return!g||!e.domUtil.contains(h,g)&&g!=h?null:(b.setStart(d.startContainer,d.startOffset),b.setEnd(d.endContainer,d.endOffset),b)},getRange:function(a){function b(a,b){var e=b||new c(d.doc,d.editor),b=d.getTrueRange(a,b);return b?b:(e.setStart(d.editor.body,0),e.collapse(!0),e)}var d=this;return!d.__lastRange||a?b():b(d.__lastRange)},addRange:function(a){a.select(),this.__historyRange=a},getNative:function(){var a=this.doc.defaultView||this.doc.parentWindow;return a.getSelection()},getNativeRange:function(){var a=this.getNative();return a.rangeCount>0?a.getRangeAt(0):null},getSelection:function(){return this.getNative()},getText:function(){return this.getSelection().toString()},getContent:function(){},reset:function(){return this.__cachedRange=null,this.__cachedStart=null,this},cache:function(){var a=this;this.__cachedRange=this.getRange(!0),this.__cachedRange&&(this.__cachedStart=a.__cachedRange.startContainer)},setCursor:function(a){var b=this.getRange(!0);if(!b)return!1;b.collapse(!a);var c=b.startContainer,d=b.startOffset;3==c.nodeType&&(b["setStart"+(d?"After":"Before")](c),b["setEnd"+(d?"Before":"After")](c));var e,f=b.startContainer.childNodes[b.startOffset]||b.startContainer.lastChild;return f&&(1==f.nodeType?("BR"!=f.tagName||"P"!=c.tagName||1!==c.childNodes.length)&&(e=this.doc.createTextNode(SinaEditor.spaceChar),b.setStartAfter(f),b.insertNode(e),b.setEnd(e,0)):3==f.nodeType&&b.setEnd(f,0)),b.collapse(),b.select(),!0},saveNative:function(){var a=this;a.__lastRange=a.getNativeRange()},getStartElem:function(){var a=this.getRange(!0).cloneRange();return a.shrinkBoundary(),start=a.startContainer,1==start.nodeType&&start.hasChildNodes()&&(start=start.childNodes[Math.min(start.childNodes.length-1,a.startOffset)]),3==start.nodeType?start.parentNode:start}},b}),function(a){if(SinaEditor.env.$belowIe9){var b=a.Util;b.mix(a.Range.prototype,{select:function(b){var c,d=this.collapsed,e=this.startContainer,f=a.spaceChar;d||this.shrinkBoundary();var g,h,i=this.createBookMark(),j=i.start;c=this.editor.selection.getNativeRange(),c.duplicate||(c=this.doc.body.createTextRange());try{c.moveToElementText(j)}catch(k){}if(d){var l=3!==e.nodeType;if(!b&&l){var m=this.doc.createElement("span");m.appendChild(this.doc.createTextNode(f)),j.parentNode.insertBefore(m,j);try{c.moveToElementText(m)}catch(k){}c.moveStart("character",1),c.collapse(!0)}else if(l&&e.hasChildNodes()&&1==e.childNodes.length&&e.childNodes[0]==j){g=this.doc.createTextNode(f),e.appendChild(g);try{c.moveToElementText(e)}catch(k){}c.moveStart("character",1),c.collapse(!0)}}else{var n=this.doc.body.createTextRange();h=i.end;try{n.moveToElementText(h)}catch(k){}c.setEndPoint("EndToEnd",n)}this.removeBookMark(i);try{c.select(),b&&g&&e.removeChild(g)}catch(k){}return this.editor.selection.saveNative(),this}})}}(SinaEditor),SinaEditor.env.$msie&&9>SinaEditor.env.version&&function(a){var b=a.Util,c=(a.dtd,a.Range);b.mix(a.Selection.prototype,{W3C:{},getNative:function(){return this.doc.selection},getNativeRange:function(){var a,b=this.getNative();try{a=b.createRange()}catch(c){this.editor.focus(),a=b.createRange()}if(!a.duplicate){var d=this,e=a.item(0),f=a.item(a.length-1),g=d.editor.doc.body.createTextRange(),h=g.duplicate(),i=d.editor.doc.createElement("span");return d.domUtil.insertBefore(i,e),i.appendChild(d.editor.doc.createTextNode(SinaEditor.spaceChar)),g.moveToElementText(e),g.moveStart("character",1),h.moveToElementText(f),h.collapse(!1),g.setEndPoint("EndToStart",h),g.select(),d.domUtil.remove(i),i=null,g}return a},saveNative:function(){var a=this;a.__lastRange=a.getNativeRange();try{a.__lastRange=a.__lastRange.duplicate()}catch(b){}a.saveW3CInfo()},saveW3CInfo:function(a){},getRange:function(a){function b(a,b){var d,g,h,i,j=b||new c(e.doc,e.editor),k=a||e.getNativeRange(),l=e.W3C;if(l.startContainer)d=l.startContainer,h=l.endContainer,g=l.startOffset,i=l.endOffset;else{if(a)try{k.select()}catch(m){}var n=f(k,!0),o=f(k,!1);d=n.container,h=o.container,g=n.offset,i=o.offset}if(e.domUtil.contains(e.domUtil.body,d)||(d=e.domUtil.body,g=0),e.domUtil.contains(e.domUtil.body,h)||(h=e.domUtil.body,i=0),j.setStart(d,g),j.setEnd(h,i),3==j.startContainer.nodeType&&j.startOffset>=j.startContainer.nodeValue.length){var p,m=j.getEnd(),q=function(a){return 3==a.nodeType&&SinaEditor.noSpaceReg.test(a.nodeValue)&&4&e.domUtil.getNodePosition(a,m)||3==m.nodeType&&a==m};p=e.domUtil.getFilterTreeDom(j.startContainer,null,q,!0),p?j.setStart(p,0):j.collapse(!0)}return j}var d,e=this,f=function(a,b){if(!a.duplicate){var c=b?a.item(0):a.item(a.length-1);a=e.editor.doc.body.createTextRange(),a.moveToElementText(c)}var d=a.duplicate();d.collapse(b);for(var f=a.duplicate(),g=d.parentElement(),h=g,i=0,j=g.childNodes,k=0;j[k];){var l=j[k];if(3!=l.nodeType&&9!=l.nodeType&&11!=l.nodeType&&8!=l.nodeType){f.moveToElementText(l);var m=f.compareEndPoints("StartToStart",d);if(0==m){i=e.domUtil.getIndexByChild(l);break}}else if(3==l.nodeType){for(var n=l.nextSibling;n&&1!=n.nodeType;)n=n.nextSibling;if(n){f.moveToElementText(n),f.collapse(!0);var m=f.compareEndPoints("StartToStart",d);if(0==m){i=e.domUtil.getIndexByChild(n);break}if(0>m){k++;continue}for(h=n.previousSibling,i=h.nodeValue.length;f.compareEndPoints("StartToStart",d)>0;)0>=i?(h=h.previousSibling,i=h.nodeValue.length):(f.moveStart("character",-1),i--);break}for(f=d.duplicate(),f.moveToElementText(g),f.collapse(!1),f.moveStart("character",-1),""!=f.htmlText&&f.moveStart("character",1),h=g.lastChild,i=h.nodeValue.length;f.compareEndPoints("StartToStart",d)>0;)0>=i?(h=h.previousSibling,i=h.nodeValue.length):(f.moveStart("character",-1),f.collapse(!0),i--);break}k++}return{container:h,offset:i}};return!e.__lastRange||a?(e.w3crng=null,e.W3C={},d=b(),e.w3crng=d):e.W3C=d=b(e.__lastRange),d.__fixRange()}})}(SinaEditor),SinaEditor.regist("Quirks",function(a){function b(a){function b(a){a=g.fixEvent(a),a.preventDefault()}function e(b,c){var e=g.$("span",a.body);g.each(e,function(a,b){g.attr(b,"se-mark","1")});var f=c.keyCode||c.which,h=f==d.DELETE;return a.getDoc().execCommand(h?"ForwardDelete":"Delete",!1,null),!1}function f(b,c){var d=g.$("span",a.body);g.each(d,function(a,b){g.attr(b,"se-mark")||(g.each(b.childNodes,function(a,c){g.insertBefore(c,b)}),b.parentNode.normalize(),g.remove(b))}),g.removeAttr(d,"se-mark")}var g=a.domUtil,h=a.body;g.on(h,"mscontrolselect",b),c.$webkit&&(a.on("beforedelete",e),a.on("afterdelete",f)),(c.$msie||c.$firefox)&&g.on(a.body,"keydown",function(b){var c=b.keyCode||b.which,e=document.activeElement;if(c==d.BACKSPACE&&g.contains(a.body,e)){var f=g.parents(e,!0);g.each(f,function(a,c){return g.attr(c,"se-widget")?(b.preventDefault(),!1):void 0})}})}var c=a.env,d=a.VK;return b}),SinaEditor.regist("PluginManager",function(a){var b=a.Util,c={__PLUGINS:{},register:function(a,b){var a=a.toLowerCase();if(this.__PLUGINS[a])throw new Error("重复定义插件："+a);this.__PLUGINS[a]=b},initPlugin:function(a,b){var d=c.__PLUGINS[a.name.toLowerCase()];if(b=b||this,a&&d){var e=a.name.toLowerCase();b.plugins[e]instanceof d||(b.plugins[e]=new d(a.params||{},b),b.fire("plugin."+e,b.plugins[e],a.params))}},initPlugins:function(a,c){function d(a,b){var d=0;b.length||a.next();for(var f=0,g=b.length;g>f;f++){var h=b[f];!function(b){setTimeout(function(){d++,i++,e.initPlugin.call(c,b),d>=g&&a.next(),i>=k&&c.fire("pluginOnLoaded")},15)}(h)}}for(var e=this,f=[],g=[],h=[],i=0,j=0,k=a.length;k>j;j++){var l=a[j];switch(l.level){case 0:f.push(l);break;case 2:h.push(l);break;default:g.push(l)}}b.Deffer(function(a){d(a,f)}).then(function(a){d(a,g)}).then(function(a){d(a,h)}).start()},addPlugin:function(a,b){c.initPlugin.call(b||this,a,b)}};return c}),SinaEditor.regist("Editor",function(a){function b(a){var b=this,e=c.uniqueId();b.COMMANDS={},b.event=new d,b.plugins={},b.opts=c.extend({root:e,id:e,emptyContent:"",plugins:[],holder:"se-holder"},a),b.id=b.opts.id,b.holder=b.opts.holder||"",b.init(b.opts)}var c=a.Util,d=a.Event,e=a.PluginManager,f=a.dtd,g=a.Quirks;return b.prototype={constructor:b,id:"",toolbars:{},getDoc:function(){return this.doc},registerCmd:function(a,b){if(a=a.toLowerCase(),this.COMMANDS[a])throw Error("重复的命令:"+a);var c={};for(var d in b)b.hasOwnProperty(d)&&void 0!==b[d]&&(c[d]=b[d]);this.COMMANDS[a]=c,c=null},exec:function(a,b){var c=this,d=c.selection,e=arguments,f=d.getRange(),g=c.domUtil,h=g.getElementPath(f);a=a.toLowerCase(),c.fire("beforeCommand",a,f);var i=+new Date;c._callCmdFn("exec",e);var i=+new Date-i;c.fire("execCommand",{cmdName:a,data:b,range:f,time:i});var j=d.getRange(!0),k=g.getElementPath(j);c.fire("afterCommand",a,j,k),j=d.getRange(!0);var l=f.equals(j);l&&g.isSamePath(h,k)||(d.saveNative(),c.__selectionChange(j,k,"command"))},queryCommandValue:function(a){return this._callCmdFn("queryCommandValue",arguments)},queryCommandState:function(a){return this._callCmdFn("queryCommandState",arguments)},focus:function(){var a=this,b=a.domUtil,c=a.doc,d=a.body,e=a.opts;d.ownerDocument==c&&b.getWin(a.doc).focus(),b.hasClass(d,e.focusCls)||b.addClass(d,e.focusCls)},setCursor:function(a){var b,c=this,d=c.body[a.position];b=c.getRange(),d?b.setStart(d,0):b.setStart(c.body,0),b.collapse(!0),b.select(!0),c.getRange(!0)},init:function(a){var b,c,d=this,f=d;d.on("pluginOnLoaded",function(){c?(f.filter=new SinaEditor.FilterHTML(f.domUtil),d.__callReady()):b=!0}),d.on("contentOnLoaded",function(){f.__initEvent(),b?(d.__callReady(),f.fire("ready")):c=!0}),e.initPlugins(a.plugins,d)},ready:function(a){this.on("ready",function(b){a.call(this,b),b.undo=!0})},on:function(a,b,c){var d=void 0===c?!0:!!c;return this.event.bind(a,b,d)},off:function(a,b){return this.event},fire:function(){return Array.prototype.unshift.call(arguments,this),this.event.fire.apply(this.event,arguments)},isEmptyContent:function(a){var b=this,c=b.domUtil.body;if(1!=c.nodeType)return!1;if(c.childNodes.length>1)return!1;var d=b.domUtil.text(c);if(d.length>0)return!1;for(var e in f.$isNotEmpty)if(c.getElementsByTagName(e).length)return!1;return!0},setContent:function(a,b){
var c=this,d={html:a};b?c.body.innerHTML=a:(c.fire("beforeSetContent",d),c.body.innerHTML=d.html,c.fire("afterSetContent")),c.fire("tmpAfterSetContent"),c.__selectionChange(null,null,"setcontent")},getContent:function(a,b){var c=this.body.innerHTML,d={html:c};b||(this.fire("beforeGetContent",d),this.fire("afterGetContent",d));var c=a?a(d.html):d.html;return c},getRange:function(a){return this.selection.getRange(a)},_callCmdFn:function(a,b){var c=this,d=b[0].toLowerCase(),e=c.COMMANDS[d];if(!e)throw new Error("命令"+d+"的"+a+"方法未定义");var f=e[a];return f?f.apply(c,b):!1},__selectionChange:function(a,b,c){var d=this.selection;a=a||d.getRange(!0),b=b||this.domUtil.getElementPath(a),this.fire("selectionchange",a,b,c)},__initEvent:function(){function a(a){var b=e.getRange(!0);b.equals(c)||(d.fire("selectionchange",b,null,a&&("string"==typeof a?a:a.type)),c=b)}function b(b){var c=b.type,d=setTimeout(function(){if(!j){var b=+new Date,e=b-i;d&&g>e?clearTimeout(d):(i=+new Date,a(c))}},g);e.saveNative()}var c,d=this,e=d.selection,f=d.body,g=200,h=d.domUtil,i=+new Date,j=!1,k="keyup keydown mouseup mousedown touchstart touchend paste cut compositionstart compositionend";h.on(f,k,function(a){a=h.fixEvent(a||window.event),d.fire(a.type,a)}),d.domUtil.on(d.doc.body,"compositionstart",function(){j=!0}),d.domUtil.on(d.doc.body,"compositionend",function(){j=!1}),d.on("mousedown",function(){d.isInBody=!0}),d.on("keyup touchend",function(a,c){b(c)}),d.domUtil.on(d.doc.body,"mouseup keyup touchend",function(a){d.isInBody&&b(a),d.isInBody=!1},!1)},__render:function(a){},addToolbar:function(a){var b=a.name;if(this.toolbars[b])throw new Error("工具条<"+b+">已定义");this.toolbars[b]=a},getToolbar:function(a){return this.toolbars[a]},__callReady:function(){var a=this;a.isEmptyContent()&&editor.setContent(a.opts.emptyContent,!0),a.opts.quirks=new g(a),editor.fire("ready")}},b}),function(a){function b(a){this.doc=a||document,this.domUtil=new e(this.doc)}function c(a){this.nodeType=a.nodeType||1,this.previousSibling=null,this.nextSibling=null,this.parentNode=null,this.lastChild=null,this.firstChild=null,this.attributes=[],this.attrs={},this.style={},this.style.cssText="",3!=this.nodeType&&8!=!this.nodeType?(this.children=[],this.tagName=a.tagName.toUpperCase(),this.tagNameLower=this.tagName.toLowerCase()):this.nodeValue=a.nodeValue}var d=a.Util,e=a.DOMUtil,f=a.dtd;b.prototype={constructor:b,createRoot:function(a,b){var d=new c({nodeType:9,tagName:a});return b&&(this.domUtil.setAttributes(d,b),b.style&&d.setAttribute("style",b.style),b.id&&d.setAttribute("id",b.id)),d},createElement:function(a,b){var d=new c({nodeType:1,attributes:b||{},tagName:a});return b&&(this.domUtil.setAttributes(d,b),b.style&&d.setAttribute("style",b.style),b.id&&d.setAttribute("id",b.id)),d},createTextNode:function(a){return new c({nodeType:3,nodeValue:d.unhtml(a)})},createComment:function(a){return new c({nodeType:8,nodeValue:a.replace(/<!--([^(-->)]*)-->/g,"$1")})}},c.ErrorCode={NODE_ERR:"is not a node object",NODE_TYPE_ERR:"nodeType error"},c.prototype={constructor:c,appendChild:function(a){if(3==this.nodeType)throw Error(c.ErrorCode.NODE_TYPE_ERR);if(!a instanceof c)throw Error(NODE_ERR);if(this.parentNode&&this.parentNode==a||this==a)throw Error("");return a.parentNode&&a.parentNode.removeChild(a),a.parentNode=this,a.previousSibling=this.children[this.children.length-1]||null,a.nextSibling=null,a.previousSibling&&(a.previousSibling.nextSibling=a),this.children.push(a),1==this.children.length&&(this.firstChild=a),this.lastChild=a,this},insertBefore:function(a,b){if(3==this.nodeType)throw Error(c.ErrorCode.NODE_TYPE_ERR);if(!a instanceof c||!b instanceof c)throw Error(NODE_ERR);if(this!==b.parentNode)return!1;a.parentNode&&a.parentNode.removeChild(a),a.parentNode=this,b.previousSibling&&(b.previousSibling.nextSibling=a),a.previousSibling=b.previousSibling,a.nextSibling=b,b.previousSibling=a;var d,e=0;do{if(d=this.children[e],d==b){this.children.unshift(a),e=null,this.firstChild=a;break}if(d.nextSibling==b){this.children.splice(e,0,a);break}}while((d=this.children[e])&&e++);return this},removeChild:function(a){if(!a instanceof c)throw Error(NODE_ERR);if(a.parentNode!=this)return null;for(var b=0,d=this.children,e=d.length;e>b;b++){var f,g,h=d[b];if(h==a){(f=d[b-1])&&(f.nextSibling=d[b+1]||null),(g=d[b+1])&&(g.previousSibling=d[b-1]||null),a.previousSibling=a.parentNode=a.nextSibling=null,d.splice(b,1),this.firstChild=d[0]||null,this.lastChild=d[d.length-1]||null,f=g=null;break}}return a},removeChildByIndex:function(a){var b=this.children[a];return b&&(b.previousSibling&&(b.previousSibling.nextSibling=b.nextSibling),b.nextSibling&&(b.nextSibling.previousSibling=b.previousSibling),b.parentNode=b.nextSibling=b.previousSibling=null,this.children.splice(a,1),this.firstChild=this.children[0]||null,this.lastChild=this.children[this.children.length-1]||null),b||null},hasChild:function(){return 0!==this.children.length},hasAttribute:function(){return 0!==this.attributes.length},getAttribute:function(a){return this.attrs[a]||null},setAttribute:function(a,b){!this.attrs[a]&&null!==this.attrs[a]&&void 0!==typeof b&&this.attributes.push({nodeValue:b,value:b,nodeType:2,nodeName:a,name:a}),this.attrs[a]=b},getELementById:function(a){},getElementsByTagName:function(a){},getElementsByClass:function(a){},getElementsByAttribute:function(a){},isCompleteEmptyNode:function(a){var b=this.parentNode,c=!0;if(3==this.nodeType||8==this.nodeType)return 0==this.nodeValue.replace(/[\s\n\r\t\u200B\uFEFF]/g,"").length?(a&&this.parentNode&&this.parentNode.removeChildByIndex(0),!0):!1;if(this.hasAttribute())return!1;for(var d=0,e=this.children;d<e.length;d++)if(e[d].isCompleteEmptyNode())a&&this.removeChildByIndex(d)&&d--;else if(c=!1,!a)break;return 0===e.length&&b&&a&&9!=this.nodeType&&!f.$empty[this.tagName]&&b.removeChild(this),c},parseHtml:function(a,b){var c=new SinaEditor.FilterHTML,d=c.filterHtml({html:a,root:this},!1,!0);return d},html:function(){function a(b,c,d){if(9==b.nodeType&&(b=b.children[0]),!b)return"";var e=b.nextSibling;b.previousSibling;if(1==b.nodeType&&f[b.tagName]){var g=b.children.length,h=b.tagNameLower;if("style"!==h&&!b.isCompleteEmptyNode()&&f[b.parentNode.tagName]&&f[b.parentNode.tagName][b.tagName]){if(c[d]+="<"+h,b.hasAttribute())for(var i,j=0,k=b.attributes,l=k.length;l>j;j++)i=k[j],c[d]+=" "+i.name+'="'+i.value+'"';f.$empty[h]?c[d]+="/>":(c[d]+=">",d+=1,c.splice(d,0,"","</"+h+">")),g&&(d=a(b.children[0],c,d)),d++}}return 3==b.nodeType&&(c[d]+=b.nodeValue),8==b.nodeType&&(c[d]+="<!--"+b.nodeValue+"-->"),e&&(d=a(e,c,d)),d}var b=this,c=[""];return a(b,c,0),c.join("")}},a.Elem=b}(SinaEditor),SinaEditor.regist("FilterHTML",function(a){var b=a.dtd,c=a.Util,d=function(a,b){this.domUtil=a,this.doc=a.doc};return d.prototype={constructor:SinaEditor.FilterHTML,elem:new SinaEditor.Elem,fillChar:SinaEditor.spaceChar,browser:SinaEditor.env,isBr:function(a){return a&&1==a.nodeType&&"BR"==a.tagName},isEmptyElement:function(a){if(!a)return!1;if(1!=a.nodeType)return!1;if(a.childNodes.length>0)return!1;for(var b,d=0;(b=a.childNodes[d])&&d++;){if(1==b.nodeType)return!1;if(3==b.nodeType&&0==c.trim(b.nodeValue).replace(new RegExp(fillChar,"g"),"").length)return!0}return!1},pasteHtml:function(a){var b,c=a,d=this.browser,e=this,f=this.domUtil;if(d.$webkit){for(var g,h=c.querySelectorAll("div br"),i=0;g=h[i++];){var j=g.parentNode;j&&"DIV"==j.tagName&&1==j.childNodes.length&&(j.innerHTML="<p><br/></p>",f.remove(j))}for(var k,l=c.querySelectorAll("meta"),i=0;k=l[i++];)f.remove(k);var h=c.querySelectorAll("br");for(i=0;k=h[i++];)/^apple-/i.test(k.className)&&f.remove(k)}if(d.$firefox){var m=c.querySelectorAll("[_moz_dirty]");for(i=0;k=m[i++];)k.removeAttribute("_moz_dirty")}if(!d.$msie)for(var k,n=c.querySelectorAll("span.Apple-style-span"),i=0;k=n[i++];)f.remove(k,!0);b=c.innerHTML,b=this.filterWord(b);var o=this.filterHtml({html:b},!1,!0,!1),p=o.root;return d.$webkit&&(p.lastChild&&e.isBr(p.lastChild)&&p.removeChild(p.lastChild),e.domUtil.each(e.domUtil.body.querySelectorAll("div"),function(a){e.isEmptyElement(a)&&f.isBlock(a)&&f.remove(a)})),o.html=p.html(),p.root=null,o.html},filterWord:function(a){function b(a){var b=new RegExp(/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/gi);return b.test(a)}function c(a){return a=a.replace(/([\d.]+)([\w]+)?/g,function(a,b,c){return(Math.round(parseFloat(b))||1)+(c||"px")})}function d(a){return a=a.replace(/\r\n|\n|\r/gi,""),a=a.replace(/^\s*(&nbsp;)+/gi,""),a=a.replace(/(&nbsp;|<br[^>]*>)+\s*$/gi,""),a=a.replace(/<!--[\s\S]*?-->/gi,""),a=a.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>"),a=a.replace(/(lang)\s*=\s*([\'\"]?)[\w-]+\2/gi,""),a=a.replace(/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(a,b,d){for(var e=[],f=0,g=d.replace(/^\s+|\s+$/,"").replace(/&quot;/gi,"'").split(/;\s*/g),f=0;f<g.length;f++){var h,i,j=g[f],k=j.split(":");if(2==k.length){switch(h=k[0].toLowerCase(),i=k[1].toLowerCase(),h){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":e[f++]=h.replace(/^mso-|-alt$/g,"")+":"+c(i);continue;case"horiz-align":e[f++]="text-align:"+i;continue;case"vert-align":e[f++]="vertical-align:"+i;continue;case"font-color":case"mso-foreground":e[f++]="color:"+i;continue;case"mso-background":case"mso-highlight":e[f++]="background:"+i;continue;case"mso-default-height":e[f++]="min-height:"+c(i);continue;case"mso-default-width":e[f++]="min-width:"+c(i);continue;case"mso-padding-between-alt":e[f++]="border-collapse:separate;border-spacing:"+c(i);continue;case"text-line-through":("single"==i||"double"==i)&&(e[f++]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==i&&(e[f++]="display:none");continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(h))continue;e[f]=h+":"+k[1]}}return f>0?b+' style="'+e.join(";")+'"':b}),a=a.replace(/([ ]+)<\/span>/gi,function(a,b){return new Array(b.length+1).join("&nbsp;")+"</span>"})}return function(a){return b(a)?d(a):a}}(this),filterHtml:function(a,d,e,f){function g(a,b,c){var d=a;return c&&(c.isAddParent?d=c:9==d.nodeType&&(d=h(d,"p","",w,null,!0))),r[d.tagName.toLowerCase()]?(d=h(a,r[d.tagName],null,null,!0),d=g(d,b,a)):d.appendChild(j.elem.createTextNode(b)),a}function h(a,d,e,g,i,k){var l;if(s[d])return a;if(t[d]&&(d=t[d]),!b[d])return a;if(l=q[d]){for(var n,o=a;o!=g;){if(c.isArray(l)?c.inArray(l,o.tagName.toLowerCase()):l==o.tagName.toLowerCase()){a=o,n=!0;break}o=o.parentNode}if(!n){var r=!1;i&&i.isAddParent&&(r=c.isArray(l)?c.inArray(l,i.tagName.toLowerCase()):l==i.tagName.toLowerCase()),a=r?i:h(a,c.isArray(l)?l[0]:l,"",g,a.lastChild,!0)}}var u,v=j.elem.createElement(d);for(v.isAddParent=!!k,b.$block[d]||a!=g?a.isAddParent&&(c.isArray(l)?!c.inArray(l,a.tagName.toLowerCase()):l!=a.tagName.toLowerCase())&&(a=a.parentNode):a=i&&i.isAddParent&&b[i.tagName][d]?i:h(a,"p","",g,!0);a&&!b[a.tagName][d]&&a!=g;)a=a.parentNode;if(a.appendChild(v),e){for(var w,x={};w=m.exec(e);)x[w[1].toLowerCase()]=p[w[1].toLowerCase()]?w[2]||w[3]||w[4]:c.unhtml(w[2]||w[3]||w[4]);u=x}return u&&f&&(j.domUtil.setAttributes(v,u),u.style&&v.setAttribute("style",u.style),u.id&&v.setAttribute("id",u.id)),b.$empty[d]?a:v}var i=+new Date,j=this,k=a.html,l=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/<>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,m=f?/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:\"([^\"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g:/(id|bookmarktag)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/gi,n={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};k=k.replace(new RegExp(j.fillChar,"g"),""),d||(k=k.replace(new RegExp("[\\r\\t\\n"+(d?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(d?"":" ")+"]*","g"),function(a,b){return b&&n[b.toLowerCase()]?a.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):a.replace(new RegExp("^[\\r\\n"+(d?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(d?"":" ")+"]+$"),"")}));for(var o,p={href:1,src:1},q={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},r={ol:"li",ul:"li"},s={nav:1,article:1,title:1,header:1,aside:1,tbcc:1,table:1,tbody:1,input:1,iframe:1,textarea:1,form:1,script:1,link:1,html:1,xml:1,meta:1,body:1,caption:1,select:1,option:1,optgroup:1,button:1,img:f?!1:1,video:1,audio:1,"w:sdt":1,"o:p":1,"w:sdtpr":1},t={th:"p",tr:"p",td:"span",a:f?"a":"span",div:f?"div":"p"},u=0,v=0,w=a.root||j.elem.createRoot("div"),x=w;o=l.exec(k);){u=o.index;try{if(u>v&&(x=g(x,k.slice(v,u),x.lastChild)),o[3])x=b.$cdata[x.tagName]?g(x,o[0],x.lastChild):h(x,o[3].toLowerCase(),o[4],w,x.lastChild);else if(o[1]){if(b.$block[y]&&(x=w),x!=w){for(;!b[x.tagName][o[1]]&&x!=w;)x=x.parentNode;if(x==w){v=l.lastIndex;continue}if(b.$cdata[x.tagName]&&!b.$cdata[o[1]])x=g(x,o[0],x.lastChild);else{var y=o[1].toLowerCase();if(s[y]){v=l.lastIndex;continue}for(t[y]&&(y=t[y]),q[y]&&(y=q[y][0]||q[y]);x&&!b[x.tagName][y]&&x!=w;)x=x.parentNode;if(x==w){v=l.lastIndex;continue}for(var z=x;1==x.nodeType&&x.tagName.toLowerCase()!=y;)if(x=x.parentNode,x==w){x=z;break}x=x.parentNode}}}else!o[2]}catch(A){throw new Error(A)}v=l.lastIndex}v<k.length&&g(x,k.slice(v),x.lastChild);var a=w.html();try{console.info("filterHTml time:"+(+new Date-i)+"ms")}catch(A){}return e?{html:a,root:w}:(w=null,{html:a})}},d}),SinaEditor.PluginManager.register("initDivContent",function(a,b){var c=SinaEditor,d=c.Util,e=c.DOMUtil,f=c.Selection,g=+new Date;a=d.extend({id:"SinaEditor_"+g,formId:"SinaEditor_form_"+g,clz:""},a,b.options);var h=new e,i=b.opts.root;"string"==typeof i&&(i=h.$(i)[0]),i&&(h.attr(i,"contentEditable","true"),h.addClass(a.clz),b.win=window,b.doc=document,b.body=i,b.domUtil=new e(b.doc,b.win,i),b.selection=new f(b.doc,b),b.fire("contentOnLoaded"))});var THEME={};THEME.boldBtn={html:'<button role="" class=""></button>',icon:"",activeCls:"active",position:"relative",pos:[]},THEME.italicBtn={html:'<button role="" class=""></button>',icon:"",activeCls:"active",position:"relative",pos:[]},SinaEditor.regist("ui.HTMLTemplate",function(a){var b=a.Util,c=a.DOMUtil,d=function(a,d){var e=this;if(!a)throw new Error("tmpl未定义");e.opts=b.merge(d,{uniqueID:b.uniqueId("template"),pattern:/(#\{(.*?)\})/g}),e.domUtil=e.opts.domUtil||new c,e.tmpl=a};return d.prototype={constructor:d,evaluate:function(a){var b=this;return b.tmpl.replace(b.opts.pattern,function(){return a[arguments[2]]||""})},evaluateMulti:function(a,c){var d=this,e=[];return d.domUtil.each(a,function(){}),d.domUtil.each(a,b.bind(function(b,f){b=c?a.length-b:b,e[b]=d.evaluate(f)},d)),e.join("")},getHtmlString:function(){return this._htmlStr||(this._htmlStr=this.evaluate(this.getNodeIds())),this._htmlStr},getNodeIds:function(){if(!this._nodes){var a,b,c,d=/\{[^\}]+(?=\})/g,e={},f=this._getUniqueID();if(this.__templateNodesIDs=this.tmpl.match(d),b=this.__templateNodesIDs)for(a=b.length;a--;)c=b[a].replace("{",""),e[c]=c+"_"+f;this._nodes=e}return this._nodes},getNodeId:function(a){return this._nodes||this.getNodeIds(),this._nodes[a]},getNode:function(a){var b=this.getNodeId(a);return b&&b.length?this.domUtil.$("#"+b)[0]:null},_getUniqueID:function(){return this.opts.uniqueID||(this.opts.uniqueID=b.uniqueId("template")),this.opts.uniqueID}},d}),SinaEditor.regist("ui.Layer",function(a){function b(a){var b,g=this;g.opts=e.extend({html:'<div id="#{panel}">test</div>'},a),b=g.domUtil=new c,g.tmpl=new f(g.opts.html);var h=b.createElementByHTML(g.tmpl.getHtmlString());b.doc.body.appendChild(h),g.event=new d,g.node=g.tmpl.getNode("panel"),g.isHidden="none"===b.getStyle(g.node,"display")}var c=a.DOMUtil,d=a.Event,e=a.Util,f=a.ui.HTMLTemplate;return b.prototype={constructor:b,node:null,isHidden:!0,getNode:function(a){return this.tmpl.getNode(a)},show:function(a){var b=this;b.node.style.display="block",a&&a.left&&a.top&&b.setPos(a.left,a.top),b.isHidden=!1,b.fire("show")},hide:function(){var a=this;a.node.style.top="-10000px",a.isHidden=!0,a.fire("hide")},setPos:function(a,b){var c=this.node;c.style.left=parseInt(a,10)+"px",c.style.top=parseInt(b,10)+"px"},fire:function(a,b){this.event.fire(this,a,b)},on:function(a,b){this.event.on(this,a,b)},off:function(a,b){this.event.off(a,b)},getRect:function(){return this.node.getBoundingClientRect()}},b}),SinaEditor.regist("ui.WinBox",function(a){var b=a.Util,c=a.DOMUtil,d=function(a,b){var d,e;return d="alert"===a.type?winDialog.alert(a.text,a,b):"confirm"===a.type?winDialog.confirm(a.text,a,b):winDialog.create(a,b),d?(d.getNode=this.getNode,e=new c,d.$dom=e,this.$supper=d,d):void 0};return b.mix(d.prototype,{getNode:function(a){return this.nodes[a]},destroy:function(){this.destroyed=!0,this.$supper.destroy()},__updateDialogPosition:function(a){this.destroyed||a.setMiddle()}}),d}),SinaEditor.regist("ui.Button",function(a){function b(a){var b=this;a=b.opts=e.extend({id:"",name:"",html:"",icon:"",activeCls:"active",disableCls:"disable",position:"relative",entityName:"entity",tooltip:""},a);var f=b.domUtil=a.domUtil||new c;b.node=null,b.name=a.name,b.id=a.id||a.name,b.html=a.html,b.__bindFunc=[],b.event=new d,b.id&&(b.node=f.$("#"+b.id)[0]),b.node&&(b.node.title=a.tooltip)}var c=a.DOMUtil,d=a.Event,e=a.Util,f=a.ui.HTMLTemplate;return b.prototype={constructor:b,actived:!1,disabled:!1,destroyed:!1,node:null,getNode:function(a){var b=this;if(b.destroyed)throw new Error("按钮已被销毁");return b.node||(b.node=b.createNode(b.html)),a?this.tmpl?this.tmpl.getNode(a):null:this.node},createNode:function(a){var b,c,d=this,e=d.domUtil;if(!a)throw new Error("html 未定义");return d.tmpl=new f(a),c=e.createElementByHTML(d.tmpl.getHtmlString()),d.id=d.tmpl.getNodeId(d.opts.entityName),e.hasClass(d.icon)||e.addClass(d.icon),d.tooltip&&(b.title=d.tooltip),this.node=b},on:function(a,b){this.event.on(this,a,b)},off:function(a,b){this.event.off(this,a,b)},fire:function(a,b){var c=e.toArray(arguments);c.unshift(this),this.event.fire.apply(this.event,c)},destroy:function(){var a=this,b=a.domUtil;b.each(a.__bindFunc,function(b,c){a.off(c.name,c.func)}),b.remove(a.node),a.destroyed=!0,a.node=null},setPos:function(a,b){},active:function(){var a=this;a.domUtil.addClass(a.node,a.opts.activeCls),a.actived=!0,a.disabled=!1},normal:function(){var a=this;a.domUtil.delClass(a.node,a.opts.activeCls),a.actived=!1,a.disabled=!1},disable:function(){var a=this;a.domUtil.delClass(a.node,a.opts.activeCls),a.domUtil.addClass(a.node,a.opts.disableCls),a.actived=!1,a.disabled=!0}},b}),SinaEditor.regist("ui.GroupButton",function(a){function b(a){var b=this;a=b.opts=f.extend({name:"",icon:"",activeCls:"active",disableCls:"disable",tooltip:"",entityName:"entity",contentName:"content",buttons:[]},a);var g=b.domUtil=a.domUtil||new c;b.node=null,b.name=a.name,b.id=a.id,b.html=a.html,b.exec=a.exec||a.name,b.__bindFunc=[],b.event=new e,b.id&&(b.node=g.$("#"+b.id)[0]);var h=b.buttons=[];g.each(a.buttons,function(b,c){var e=new d(f.merge(c,{icon:a.icon,activeCls:a.activeCls,disableCls:a.disableCls},!1,!0));h.push(e)})}var c=a.DOMUtil,d=a.ui.Button,e=a.Event,f=a.Util,g=a.ui.HTMLTemplate;return b.prototype={constructor:b,actived:!1,disabled:!1,destoried:!1,node:null,createNode:function(a){var b,c=this,d=c.domUtil,e=c.opts;return a&&(c.tmpl=new g(a),d.createElementByHTML(c.tmpl.getHtmlString()),b=c.tmpl.getNode(e.entityName),c.id=b),b},on:function(a,b){this.event.on(this,a,b)},off:function(a,b){this.event.off(this,a,b)},fire:function(a,b){var c=f.toArray(arguments);c.unshift(this),this.event.fire.apply(this.event,c)},destroy:function(){var a=this,b=a.domUtil;b.each(a.buttons,function(a,b){b.destroy()}),a.buttons=null},getNode:function(){var a=this;if(a.destoried)throw new Error("按钮组已被销毁");return a.node||(a.node=a.createNode(a.html))},setPos:function(a,b){},active:function(a){var b=this;b.domUtil.each(b.buttons,function(b,c){a==c.name?c.active():c.normal()})},normal:function(a){var b=this;a?b.domUtil.each(b.buttons,function(a,b){b.normal()}):b.domUtil.buttons[a].normal()},disable:function(a){var b=this;a?b.domUtil.each(b.buttons,function(a,b){b.disable()}):b.domUtil.buttons[a].disable()}},b}),SinaEditor.regist("ui.ToolBar",function(a){function b(a,b){var f=this;f.that={},f.domUtil=new c,f.__buttons=[],f.editor=b,f.cmds=[],f.opts=e.extend({id:"toolbar",name:"main",renderTo:"",tpl:"",cls:"BNE_editor_color BNE_editor_color1",style:{zIndex:300},showClass:"BNE_editor_cur",buttons:[]},a),f.name=f.opts.name,f.event=new d,f.init(),b.addToolbar(f)}var c=a.DOMUtil,d=a.Event,e=a.Util,f=a.ui.GroupButton,g=a.ui.Button;return b.prototype={constructor:b,init:function(){var a=this,b=a.opts,c=b.renderTo,d=a.domUtil;a.opts.id&&(c&&"string"==typeof c?c=d.$(c)[0]:c||(c=d.doc.body),(a.toolBarCon=d.$("#"+a.opts.id)[0])||(a.toolBarCon=d.create("div",{id:a.opts.id,className:a.opts.cls}),d.setStyle(a.toolBarCon,this.opts.style),c.appendChild(a.toolBarCon)),b.tpl&&a.setTpl(),a.render(b.buttons))},render:function(a){for(var b,c,d=this,e=0,h=a.length;h>e;e++)c=a[e],"group"==c.type?(b=new f(c),d.addGroupButton(b)):(b=new g(c),d.addButton(b))},setTpl:function(){var a=this.opts.tpl;this.toolBarCon.innerHTML=a},addButton:function(a){var b=this,c=b.domUtil,d=a.getNode();if(c.contains(b.toolBarCon,d)||b.toolBarCon.appendChild(d),c.on(d,"click",function(c){c.preventDefault(),b.editor.fire("toolbar."+a.name+".click",b)}),c.on(d,"mouseover",function(c){c.preventDefault(),b.editor.fire("toolbar."+a.name+".mouseover",b)}),c.on(d,"mouseout",function(c){c.preventDefault(),b.editor.fire("toolbar."+a.name+".mouseout",b)}),a.opts.exec){var e=a.opts.exec.toLowerCase().split(" ");c.each(e,function(a,c){b.cmds.push(c)})}else b.cmds.push(a.name);return a.toobar=b,b.__buttons.push(a),d},addGroupButton:function(a){var b,c=this,d=c.domUtil,e=a.opts,f=a.getNode();return f?(b=a.getNode(e.contentName)||f,d.each(a.buttons,function(a,d){var e=d.getNode();b.appendChild(e),c.addButton(d)}),d.contains(c.toolBarCon,f)||c.toolBarCon.appendChild(f)):d.each(a.buttons,function(a,b){c.addButton(b)}),a.toolbar=c,c.__buttons.push(a),f},getButton:function(a){var b=null;return this.domUtil.each(this.__buttons,function(c,d){return a==d.name?(b=d,!1):void 0}),b},on:function(a,b){this.event.on(this,a,b)},off:function(a,b){this.event.off(this,a,b)},fire:function(a,b){var c=e.toArray(arguments);c.unshift(this),this.event.fire.apply(this.event,c)},remove:function(a){var b=a.getNode();a.destroy(),b.parentNode.removeChild(b)},setPos:function(a,b){var c=this.toolBarCon;this.domUtil.setStyle(c,{left:parseInt(a||0,10)+"px",top:parseInt(b||0,10)+"px",position:"absolute"})},getPos:function(){var a=this.toolBarCon.style.top,b=this.toolBarCon.style.left;return{top:a,left:b}},getRect:function(){return this.domUtil.getRect(this.toolBarCon)},show:function(a,b,c){var d,e=this;if(d="number"==typeof a?a:"function"==typeof a?a.call(this):0,!this.isHidden&&c&&SinaEditor.animate){var f=this.getPos(),g={left:d-parseInt(f.left),top:b-parseInt(f.top)};SinaEditor.animate({duration:150,fps:60,func:function(a){var b=a.currFrame/a.frames;e.toolBarCon.style.left=parseInt(f.left)+b*g.left+"px",e.toolBarCon.style.top=parseInt(f.top)+b*g.top+"px"}})}else this.setPos(d,b),this.toolBarCon.style.display="inline-block",this.opts.showClass&&editor.domUtil.addClass(this.toolBarCon,this.opts.showClass),this.isHidden=!1;this.fire("show",this)},hide:function(){this.isHidden=!0,this.toolBarCon.style.display="none",this.opts.showClass&&editor.domUtil.delClass(this.toolBarCon,this.opts.showClass)},isShow:function(){return"none"!=this.toolBarCon.style.display},destroy:function(){},setTarget:function(a){this.__target=a},getTarget:function(){return this.__target}},b}),SinaEditor.animate=function(a){var b=function(a,b){return a["r"+b]||a["webkitR"+b]||a["r"+b]||a["mozR"+b]||a["msR"+b]||a["oR"+b]}(window,"equestAnimationFrame"),c=SinaEditor.animate,d=a.duration||1e3,e=a.fps||60,f={fps:e,currFrame:0,frames:Math.ceil(d*e/1e3)};if(!c.animating){c.animating=!0;var g=function(){return f.currFrame>=f.frames?(clearInterval(h),"function"==typeof a.callback&&a.callback(f),void(c.animating=!1)):(b&&b(g),f.currFrame++,void a.func(f))};if(b)b(g);else var h=setInterval(g,1e3/f.fps)}},SinaEditor.PluginManager.register("toolBar",function(a,b){function c(a,f){function g(){c.timer&&window.clearTimeout(c.timer);var a=d(h);if(!a)return i.hide(),void b.fire("toolbar.hidden",i,h);if(b.fire("toolbar.beforeshow",i,h)!==!1){var e=a.left,g=a.top,k=i.getPos();k.left!=e+"px"||k.top!=g+"px"?(j=!0,i.show(function(){b.fire("toolbar.show",this),f=f.startContainer.parentNode?f:b.getRange(!0);var a=b.domUtil.getElementPath(f);return b.fire("toolbar.selectionchange",f,a,this),e},g,!0)):i.isShow()||i.show(e,g),b.fire("toolbar.aftershow",i,h)}}var h=(b.selection,f.cloneRange()),i=e,j=(i.toolBarCon,!1);return h&&!h.collapsed?i.isShow()?(c.timer&&window.clearTimeout(c.timer),c.timer=window.setTimeout(function(){i.isShow()&&g()},100)):g():(i.hide(),b.fire("toolbar.hidden",i)),j}function d(a){if(!a.collapsed){a.shrinkBoundary();var c=a.createBookMarkByClone("pos"),d=(a.startContainer,a.startOffset,a.endContainer,a.endOffset,c.bookmark.start),f=(c.bookmark.end,SinaEditor.env.$msie&&SinaEditor.env.version<8,55),g=0,h=b.domUtil,i=function(a){return 3==a.nodeType&&!h.isBookMarkTag(a.parentNode)&&!!SinaEditor.noSpaceReg.test(a.nodeValue)||h.isBookMarkTag(a)},j=h.getFilterTreeDom(d,null,i,!0),k=j,l=j;if(!j||h.isBookMarkTag(j))return a.moveToBookMarkByClone(c),!1;for(;l&&!h.isBookMarkTag(l);)k=l,l=h.getFilterTreeDom(l,null,i,!0);var m=b.doc.createElement("span");m.style.display="inline-block",m.innerHTML="1",j.parentNode.insertBefore(m,j);var n=h.getPos(m);m.innerHTML="\ufeff",k.nextSibling?k.parentNode.insertBefore(m,k.nextSibling):k.parentNode.appendChild(m);var o,p,q,r=h.getPos(m),s=e,t=s.toolBarCon;return r.top-1===n.top&&(r.top=n.top),s.isShow()?q=t.offsetWidth/2:(t.style.display="",q=t.offsetWidth/2,t.style.display="none"),q+=g,a.setStart(j,1),a.collapse(!0),r.top===n.top?(p=r.top-f,o=n.left+(r.left-n.left)/2-q):(p=n.top-f,o=c.body.offsetWidth/2+h.getPos(c.body).left-q),h.remove(m),m=null,a.moveToBookMarkByClone(c),j=null,{left:o,top:p}}}var e,f=SinaEditor,g=f.DOMUtil,h=f.ui.Button,i=f.ui.ToolBar,j=f.ui.GroupButton,k=f.Util,l=new g;a=k.extend({id:"toolbar",tpl:"",name:"main"},a),b.on("pluginOnLoaded",function(){e=new i(a,b),e.hide(),l.each(b.plugins,function(a,b){var c,d;b&&(c=b.toolBars)&&l.each(c,function(a,b){"group"===b.type?(d=new j(b),e.addGroupButton(d)):(d=new h(b),e.addButton(d))})}),b.on("afterCommand",function(a,d,f,g){d&&k.inArray(e.cmds,d)&&(c(a,f)||b.fire("toolbar.selectionchange",f,g,e))}),b.on("selectionchange",function(a,b,d){"command"!=d&&c(a,b)}),l.hover(b.body,function(a,c){b.fire("toolbar.paragraphenter",c,e)},function(a,c){b.fire("toolbar.paragraphleave",c,e)},'p,div[se-img="wrapper"],h1,h2')})}),SinaEditor.PluginManager.register("basestyle",function(a,b){var c=SinaEditor,d=c.PluginManager,e=c.Util,f={bold:["strong","b"],italic:["em","i"],underline:["u"]},g=[{name:"bold",exec:"bold",activeCls:"hovered"},{name:"italic",exec:"italic",activeCls:"hovered"},{name:"underline",exec:"underline",activeCls:"hovered"}],h={};a=e.extend({},a);for(var i=e.extend(g,a&&a.execCommands),j=0;j<i.length;j++){var k=i[j];h[k.name]=k,function(a){d.register(a.name,function(a){}),d.addPlugin.call(b,{name:a.name,params:a}),b.on("toolbar."+a.name+".click",function(){b.exec(a.exec,a.attrs)}),b.on("toolbar.selectionchange",function(c,d,e,f){var g,i=b.queryCommandState(a.exec,d,h[name]&&h[name].attrs,f),j=f.getButton(a.name);g={"-1":"disable",0:"normal",1:"active"}[i],g&&j[g]&&j[g].call(j)})}(k)}var l=function(c,d,e){var g=f[c]||[],h=0,d=b.selection.getRange();if("function"==typeof a.disabled&&a.disabled(d))return-1;d.shrinkBoundary();var i=d.getStart(),j=b.domUtil;if(e){var k=!0;for(var l in e){k=!1;break}var m=j.parents(i);if(!m||0==m.length)return 0;var n=j.doc.createElement(g[0]);j.setAttributes(n,e);for(var h=0;h<m.length;h++){var o=m[h];if(e.style&&j.isSameStyle(m[h],n)&&j.isSameElement(m[h],n))return n=null,1;if(j.isSameElement(m[h],n))return n=null,1}return n=null,0}for(var o=i;o&&o!=j.body;){if(j.isSpecificParent(o,g,!0))return 1;o=o.parentNode}return 0};for(var m in f)(function(a){var c=f[a];b.registerCmd(a,{queryCommandState:function(b,c,d,e){return l(a,c,d)},exec:function(a,d){var e=f[a];if(e){var g=e[0],h=this.selection.getRange(),i=(h.startContainer,h.endContainer,l(a,null,d));if(h.collapsed){if(1==i){var j=b.doc.createTextNode("");h.insertNode(j),h.setStartBefore(j),h.setEndAfter(j),h.removeInlineTag(c,d,!0),h.setStartBefore(j)}else{if(0!=i)return;var k=b.doc.createElement(c[0]),m=b.doc.createTextNode(SinaEditor.spaceChar);k.appendChild(m),h.insertNode(k),h.setStart(m,1)}h.collapse(!0),h.select()}else if(1==i)h.removeInlineTag(c,d);else{if(0!=i)return!1;h.insertInlineTag(g,d)}}},queryCommandValue:function(){}})})(m);return{toolBars:i}}),SinaEditor.PluginManager.register("title",function(a,b){function c(b,c,d){if(a&&"function"==typeof a.disabled&&a.disabled(b))return-1;var e=b.domUtil,f=b.getStart(),g=!1,d=d||{},h=e.parents(f),i=e.create(c);for(e.setAttributes(i,d);h&&h.length>0;){var j=h.shift();if(j==e.body)break;if(e.isBlock(j)){j.tagName.toLowerCase()==c.toLowerCase()&&i.tagName==j.tagName&&(g=!0);break}}return i=null,g}var d=SinaEditor,e=d.Util;a=e.extend({},a);var f=function(a,c,d,e){if(-1===e)return!1;var f=b.domUtil,g=a.createBookMark(),h=function(a){return 1==a.nodeType?!a.getAttribute(b.holder)&&"br"!=a.tagName.toLowerCase()&&!f.isBookMarkTag(a):!!SinaEditor.noSpaceReg.test(a.nodeValue)};a.boundaryToBlock();for(var i,j=a.createBookMark(),k=f.getFilterTreeDom(j.start,!1,h),l=a.cloneRange();k&&!(2&f.getNodePosition(k,j.end));)if(3!=k.nodeType&&f.isBlock(k))k=f.getFilterTreeDom(k,!1,h,!0);else{for(l.setStartBefore(k);k&&k!==j.end&&!f.isBlock(k);)i=k,k=f.getFilterTreeDom(k,!1,null,null,function(a){return!f.isBlock(a)});l.setEndAfter(i);var m=l.getCommonAncestor();if(f.body!=m&&f.isBlock(m))if(e){var n=f.create(c);if(f.setAttributes(n,d),n.tagName==m.tagName){var o=f.create("P");f.copyAttrs(m,o),f.each(d,function(a,b){if("style"==a){var c=b.match(/[\w\-]+(?=\s*\:\s*)/g);if(!c)return;f.each(c,function(a,b){var c=new RegExp(""+b+"\\s*\\:\\s*[^;]+(;|$)","igm");o.style.cssText=o.style.cssText.replace(c,"")})}}),f.removeToAllChilds(m,o),f.insertBefore(o,m),f.remove(m),k=o,n=null}}else{if(m.tagName.toLowerCase()!=c.toLowerCase()){var p=f.create(c);f.removeToAllChilds(m,p),f.insertBefore(p,m),f.copyAttrs(m,p),f.remove(m),m=p,p=null}f.setAttributes(m,d),k=m}else if(!e){var p=a.doc.createElement(c);f.setAttributes(p,d);var q=l.extractContents();p.appendChild(q),l.insertNode(p),k=p}k=f.getFilterTreeDom(k,!1,h)}a.moveToBookMark(j),a.moveToBookMark(g)},g={h1:{},h2:{}};b.registerCmd("title",{queryCommandState:function(a,b,d){var e=g[d];return c(b,d,e)},exec:function(a,d){var e=g[d];if(void 0===e)return!1;var h=b.selection.getRange();f(h,d,e,c(h,d,e))}})}),SinaEditor.PluginManager.register("titleBtn",function(a,b){for(var c=[],d=["h1","h2"],e=0;e<d.length;e++){var f=d[e];!function(a){var c=a;b.on("toolbar.selectionchange",function(a,d,e,f){var g=function(a){return f.getButton("title_"+a+"_btn")},h=g(c),i=!b.queryCommandState("title",d,c);i?h.normal():-1!=i&&h.active()}),b.on("toolbar.title_"+a+"_btn.click",function(c,d){d.getButton("title_"+a+"_btn");b.exec("title",a)})}(f),c.push({id:"title_"+f+"_btn",name:"title_"+f+"_btn",exec:"title",tooltip:"",activeCls:"hovered"})}return{toolBars:c}}),SinaEditor.PluginManager.register("justify",function(a,b){var c=function(a,c){var d=b.domUtil,e=a.createBookMark(),f=function(a){return 1==a.nodeType?!a.getAttribute(b.holder)&&"br"!=a.tagName.toLowerCase()&&!d.isBookMarkTag(a):!!SinaEditor.noSpaceReg.test(a.nodeValue);
};a.boundaryToBlock();for(var g,h=a.createBookMark(),i=d.getFilterTreeDom(h.start,!1,f),j=a.cloneRange();i&&!(2&d.getNodePosition(i,h.end));)if(3!=i.nodeType&&d.isBlock(i))i=d.getFilterTreeDom(i,!1,f,!0);else{for(j.setStartBefore(i);i&&i!==h.end&&!d.isBlock(i);)g=i,i=d.getFilterTreeDom(i,!1,null,null,function(a){return!d.isBlock(a)});j.setEndAfter(g);var k=j.getCommonAncestor();if(d.body!=k&&d.isBlock(k))d.setAttributes(k,{style:"text-align:"+c}),i=k;else{var l=a.doc.createElement("p");d.setAttributes(l,{style:"text-align:"+c});var m=j.extractContents();l.appendChild(m),j.insertNode(l),i=l}i=d.getFilterTreeDom(i,!1,f)}a.moveToBookMark(h),a.moveToBookMark(e)},d=function(c,d){var d=b.getRange(!0);if(a&&"function"==typeof a.disabled&&a.disabled(d))return-1;for(var e,f,g=d.getStart(),h=d.domUtil,i=h.parents(g);e=i.shift();){if(!e)return"left";if(h.isBlock(e)){f=e.style.cssText.match(/text\-align\s*:\s*(left|right|center)/i),f=f&&f[1]?f[1]:"left";break}}return d=null,f||"left"};b.registerCmd("justify",{queryCommandState:d,exec:function(a,e){var f=d("justify");-1!==f&&f!=e&&c(b.selection.getRange(),e)}})}),SinaEditor.PluginManager.register("justifyBtn",function(a,b){for(var c=[{type:"group",name:"justify",activeCls:"hovered",buttons:[]}],d=["left","center","right"],e=0;e<d.length;e++){var f=d[e];!function(a){b.on("toolbar.justify_"+a+"_btn.click",function(c,d){var e=d.getButton("justify_"+a+"_btn");e.actived||b.exec("justify",a)})}(f),c[0].buttons.push({id:"justify_"+f+"_btn",name:"justify_"+f+"_btn",exec:"justify",tooltip:"",activeCls:"hovered"})}return b.on("toolbar.selectionchange",function(a,c,d,e){var f=e.getButton("justify"),g=b.queryCommandState("justify",c);-1!==g&&f.active("justify_"+g+"_btn")}),{toolBars:c}}),SinaEditor.PluginManager.register("colorPicker",function(a,b){function c(a){function b(a){return 1==a.length?"0"+a:a}var a=a.toLowerCase();if(0!=a.indexOf("rgb"))return a;var c,d,e,f;return f=a.match(/^rgb\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\)\s*/),4!=f.length?a:(c=parseInt(f[1]),d=parseInt(f[2]),e=parseInt(f[3]),"#"+b(c.toString(16))+b(d.toString(16))+b(e.toString(16)))}function d(){function a(a){if(3==a.nodeType||"span"!=a.tagName.toLowerCase())return 0;if(SinaEditor.env.$msie){var b=a.attributes;if(b.length){for(var c=0,d=b.length;d>c;c++)if(b[c].specified)return 0;return 1}if(SinaEditor.env.version<9){b=[];var e=a.outerHTML;e.replace(/\s+([a-z0-9]+)(=['"]?([^='"\s>]+)['"]?(?=>|\s+?))?/i,function(a,c,d,e){"bookmarkTag"!=c&&"style"!=c&&b.push({nodeType:2,value:e,nodeName:c})})}}return!a.attributes.length}function c(b){var c=b.createBookMark();!b.collapsed;var j=k.isSpecificParent(b.startContainer,"a",!0);for(j&&b.setStartBefore(j),j=k.isSpecificParent(b.endContainer,"a",!0),j&&b.setEndAfter(j),e=b.createBookMark(),q=e.start;(f=q.parentNode)&&!k.isBlock(f);)k.breakParent(q,f),k.clearSpecialNode(q);if(e.end){for(q=e.end;(f=q.parentNode)&&!k.isBlock(f);)k.breakParent(q,f),k.clearSpecialNode(q);for(var m,n=k.getFilterTreeDom(e.start,null,l,!1),o=new RegExp(i+"\\s*:[^;]*(?=;|$)","gi");n&&n!=e.end;)m=k.getFilterTreeDom(n,null,l,!0),g.$empty[n.tagName.toLowerCase()]||k.isBookMarkTag(n)||(h.test(n.tagName)?i?(k.setCSSText(n,n.style.cssText.replace(o,"")),a(n)&&"text-decoration"!=i.toLowerCase()&&k.remove(n,!0)):k.remove(n,!0):!g.$tableContent[n.tagName]&&!g.$list[n.tagName]&&a(n)&&k.remove(n,!0)),n=m}b.moveToBookMark(e),b.moveToBookMark(c);for(var p,q=b.startContainer,r=b.collapsed;1==q.nodeType&&d(q)&&g.$removeEmpty[q.tagName];)p=q.parentNode,b.setStartBefore(q),b.startContainer===b.endContainer&&b.endOffset--,k.remove(q),q=p;if(!r)for(q=b.endContainer;1==q.nodeType&&d(q)&&g.$removeEmpty[q.tagName];)p=q.parentNode,b.setEndBefore(q),k.remove(q),q=p}function d(a){if(1!=a.nodeType)return!1;for(var b,c=0,e=0;b=a.childNodes[e];){if(3==b.nodeType&&SinaEditor.noSpaceReg.test(b.nodeValue)){c++;break}if(1==b.nodeType){if("BR"==b.tagName&&1==a.childNodes.length){c++;break}if(!d(b)){c++;break}}e++}return 0===c}var e,f,h=new RegExp("^(?:SPAN)$","i"),i="color",j=b.getRange(),k=b.domUtil,l=function(a){return 1==a.nodeType};c(j),j.moveToTxtNode()}var e=SinaEditor,f=e.Util,g=e.dtd;a=f.extend({fixTagA:""},a),b.on("beforeCommand",function(b,c,e){"skip"==a.fixTagA&&"link"==c&&d()}),b.registerCmd("color",{queryCommandState:function(a,d){for(var e,f,d=d||b.getRange(),g=d.getStart(),h=d.domUtil,i=h.parents(g);e=i.shift();){if(!e)return"";if("SPAN"==e.tagName&&(f=h.getStyle(e,"color")))return c(f)}return""},exec:function(c,e,f){this.queryCommandState("color",g)&&d();var g=b.getRange(),h=b.domUtil;if("boundary"===a.fixTagA){var i=h.isSpecificParent(g.startContainer,"a",!0);i&&g.setStart(i,0),i=h.isSpecificParent(g.endContainer,"a",!0),i&&g.setEnd(i,1)}g.insertInlineTag("span",{style:"color:"+e+";"},function(b){if("skip"==a.fixTagA){if(1==b.nodeType&&"A"==b.tagName||"A"==b.parentNode.tagName)return!1;var c=h.isSpecificParent(b,"a",!0);return!c}return!0})}}),b.registerCmd("resetColor",{exec:function(a){d()}})}),function(){function a(a,e){var f,g,h=e.domUtil,i=c.ui.Layer,j=this;this.options=d.extend({},this.DEFAULT,a);var k=b(this.options.html,this.options.template,this.options.colors),l=new i({html:k}),m=this.options.delegateSelector;e.on("toolbar.colorPickerBtn.click",function(a,b){b.hide();var c=b.getPos();l.show(c);for(var d,i=e.queryCommandState("color",e.getRange())||j.options.resetColor,k=l.getNode("panel"),m=h.$("[colorValue]",k);m.length;)d=m.pop(),h.delClass(d,j.options.pickerActiveCls);var n=(e.doc.getElementById("color_range_"+j.options.resetColor),e.doc.getElementById("color_range_"+i));n&&(h.addClass(n,j.options.pickerActiveCls),g=n),f=b}),e.on("toolbar.selectionchange",function(a,b,c,d){var f=e.queryCommandState("color",b);f=f==j.options.resetColor?"":f,e.fire("plugin.colorPickerBtn.ok",d.getButton("colorPickerBtn"),f)},!1),e.on("toolbar.show toolbar.hidden",function(a){l.hide()});var n=l.getNode("panel");return h.on(n,"mouseover",function(a){h.addClass(this,j.options.pickerActiveCls)},!1,m),h.on(n,"mouseout",function(a){g!=this&&h.delClass(this,j.options.pickerActiveCls)},!1,m),h.on(n,"click",function(a){l.hide();var b,c=this.getAttribute("colorValue");if(j.options.resetColor==c?e.exec("resetColor"):e.exec("color",c),f&&(b=f.getButton("colorPickerBtn")),c=c==j.options.resetColor?"":c){var d=e.getRange(),g=h.isSpecificParent(d.startContainer,"a",!0);g&&(c=e.queryCommandState("color",d))}e.fire("plugin.colorPickerBtn.ok",b,c),e.selection.getRange().select()},!1,m),h.each(this.options.events,function(a,b){e.on(a,b)}),{toolBars:[{id:"colorPicker",name:"colorPickerBtn",exec:"color resetColor",tooltip:"字体颜色",activeCls:"hovered"}]}}function b(a,b,c,d){for(var e=[],f=0;f<c.length;f++)e.push(b.replace(/<\{color\}>/gi,c[f])),c[f]===d&&e[e.length-1];var g=e.join("");return e=null,a.replace(/<\{colors}\>/,g)}var c=SinaEditor,d=c.Util;c.DOMUtil;a.prototype.DEFAULT={colors:["#cc0000","#d56a00","#a29900","#55a455","#3398cc","#663399","#cc0066","#cdcdce","#333333"],html:['<div id="#{panel}" style="display:none;position:absolute;z-index:301;" class="BNE_editor_color BNE_editor_color1" ><{colors}></div>'].join(""),template:'<span class="color_all" style="background-color:<{color}>" colorValue="<{color}>" id="color_range_<{color}>"></span>',activeCls:"hovered",pickerActiveCls:"clicked",delegateSelector:"span.color_all",resetColor:"#333333",events:{}},SinaEditor.PluginManager.register("colorPickerBtn",a)}(),function(a){function b(a,e){function f(a){var c=b.hotKey;if(!c)return!1;var d=c.getExecByEvent(a);return d&&"todo"==d.exec}function g(a){return"undo"==a?k>0&&j.length>0:k<j.length-1}var h,i,j=[],k=0,l=this,m=!1,n=!1;l.editor=e,l.options=c.extend({},l.DEFAULT,a),l.editor=e,l.getSegment=function(a){return j[a]||null},l.getIndex=function(){return k},l.setSegment=function(a,b){return j[a]&&c.extend(j[a],b),j[a]},l.pushSegment=function(a,b,c){j=j.slice(0,k+1),j.length>l.options.maxRange&&j.shift(),k=j.push({range:a,content:b,contentWithRange:c})-1,j.length>l.options.maxRange&&(j.shift(),k--)},l.getCurrentSegment=function(){return l.getSegment(k)},h=l.options.hotKey,e.on("saveUndo",function(a,b,c){l.save(b,c)}),e.on("ready",function(){e.domUtil;e.on("keydown",function(a,b){if(!d.modifierPressed(b)&&!d.metaKeyPressed(b)){var c=e.selection.getRange(!0);f(b)||(i&&clearTimeout(i),i=window.setTimeout(function(){n||(l.save(),i=null)},l.options.saveTimer),c.collapsed||(l.save(!0,!1),m=!0,i&&clearTimeout(i)))}}),e.on("keyup",function(a,b){n||m&&(l.save(),m=!1)}),e.on("beforeCommand",function(a,b,c){e._callCmdFn("queryNoUndoState",[b,c])||l.save(!0,!1)}),e.on("afterCommand",function(a,b,c){e._callCmdFn("queryNoUndoState",[b,c])||l.save(!1,!0,c)},!1),e.on("compositionstart",function(a,b){n=!0}),e.on("compositionend",function(){n=!1})}),e.registerCmd("todo",{queryCommandState:function(a){return g(a)},exec:function(a,b){if(g(b)){if("undo"==b&&(!j[k]||1==j.length))return j=[],void(k=0);if("redo"==b&&!j[k])return void(k=j.length-1);l.todo("undo"==b?--k:++k)}},queryNoUndoState:function(a){return!0}}),h&&e.on("plugin.hotkey",function(a,c){b.hotKey=c,c.registerHotkey([{exec:"todo",params:"undo",hotkeys:h.undo},{exec:"todo",params:"redo",hotkeys:h.redo}])})}var c=a.Util,d=a.VK;b.prototype={constructor:b,DEFAULT:{maxRange:10,hotKey:{undo:["ctrl+90"],redo:["ctrl+89"]},saveTimer:500},save:function(a,b,c){var d=this,e=d.editor,c=c||e.getRange(!0);try{if(!c)return;b=b===!1?!1:!0;var f=e.getContent(null,!0),g=d.getCurrentSegment(),h="";if(a&&g&&g.content==f&&!c.collapsed){var i=c.createBookMarkByClone("undo_range");if(h=i.content,c.moveToBookMarkByClone(i),h!==g.contentWithRange){var j=d.getIndex();d.setSegment(j,{range:c,contentWithRange:h})}}if(b&&(!g||g.content!=f)){var i=c.createBookMarkByClone("undo_range");h=i.content,c.moveToBookMarkByClone(i),d.pushSegment(c,f,h)}}catch(k){console.log(k.message,"  ",k.stack)}},todo:function(a){var b=this.getSegment(a),c=this.editor;b&&(c.setContent(b.contentWithRange,!0),b.range.moveToBookMark("undo_range"))}},a.PluginManager.register("undo",b)}(SinaEditor),SinaEditor.PluginManager.register("enterkey",function(a,b){function c(a){var c=b.domUtil,d=["ul","ol","dl","p","h1","h2","h3","h4","h5","h6"];if(f.inArray(h,a)){var e=b.selection.getRange(!0),g=e.startContainer,i=e.startOffset;if(1==g.nodeType&&(g=g.childNodes[i]),g&&c.isSpecificParent(g,d)){if(3==g.nodeType&&i===g.nodeValue.length){var j=b.doc.createTextNode("​");g.parentNode.appendChild(j)}}else{!g||1!=g.nodeType||"BR"!=g.tagName,b.doc.execCommand("formatBlock",!1,"<"+a+">");var k=e.startContainer;if(1==k.childNodes.length&&1==k.childNodes[0].nodeType&&"BR"==k.childNodes[0].tagName){var l=b.doc.createTextNode("​");k.insertBefore(l,k.childNodes[0]),k.removeChild(k.childNodes[1])}}}}var d=SinaEditor,e=d.VK,f=d.Util,g=a.tagName||"p",h=["br","p"];b.on("keydown",function(a,d){d.keyCode==e.ENTER&&(d=b.domUtil.fixEvent(d),!1!==b.fire("beforeenter",d)?(c(g),window.setTimeout(function(){var a=b.getRange(!0).cloneRange();a.boundaryToBlock();var c=a.startContainer;c&&c!=b.domUtil.body&&(c.style.cssText="",/h\d/gi.test(c.tagName)&&b.doc.execCommand("formatBlock",!1,"<p>")),b.fire("afterenter",d),b.fire("undosave",!0,!0)},0)):d.preventDefault())})}),SinaEditor.PluginManager.register("deletekey",function(a,b){function c(a){var c=b.getRange(!0),d=c.startContainer,e=c.startOffset;if(0==e&&d.parentNode==b.domUtil.body&&b.domUtil.body.firstChild==d){c.collapsed||c.deleteContents();var f=c.cloneRange();if(f.boundaryToBlock(),f.startContainer!=b.domUtil.body){f.startContainer.style.cssText="","p"!=f.startContainer.tagName&&b.doc.execCommand("formatBlock",!1,"<p>");var g=b.doc.createTextNode(SinaEditor.spaceChar);f.setStart(b.body.firstChild,0),f.insertNode(g),f.collapse(!0),f.select(!0)}return!0}if(h.$belowIe9){if(!c.collapsed)return c.createBookMark("tmp_ie"),c.deleteContents(),c.removeBookMark("tmp_ie"),c.select(!0),!0;c.createBookMark("tmp_ie"),c.removeBookMark("tmp_ie"),c.select(!0)}return!1}var d=SinaEditor,e=d.VK,f=e.BACKSPACE,g=e.DELETE,h=d.env;d.spaceChar.charCodeAt(0);b.on("keydown",function(a,d){d=b.domUtil.fixEvent(d);var e,h=d.keyCode||d.which,i=h==g;(h==f||i)&&(e=b.fire("beforedelete",d),!1!==e?c(i)&&d.preventDefault():d.preventDefault())}),b.on("keyup",function(a,c){c=b.domUtil.fixEvent(c);c.keyCode||c.which})}),SinaEditor.PluginManager.register("paste",function(a,b){function c(c,d){var e=b.doc.createElement("div");if(e.style.display="inline",e.innerHTML=d,e.firstChild)if(c.collapsed||c.deleteContents(),"function"!=typeof a.getType||"text/plain"!=a.getType(c)){c.moveToTxtNode(!1,!1,!0);var f,g;b.doc.createTextNode("pastebin");g=b.doc.createDocumentFragment();var h=c.startContainer,i=c.startOffset,j=!1;if(!SinaEditor.env.$msie&&SinaEditor.env.version<=10){var k=c.startContainer;if(3==k.nodeType&&c.startOffset>=k.nodeValue.length&&k.nextSibling&&1==k.nextSibling.nodeType&&(k=k.nextSibling),1==k.nodeType&&"BR"==k.tagName){for(;k&&k.parentNode&&k.parentNode!=b.domUtil.body;){if(b.domUtil.isBlock(k.parentNode)){c.setStartBefore(k),b.domUtil.remove(k),c.collapse(!0);break}k=k.parentNode}h=c.startContainer,i=c.startOffset}}var l=c.cloneRange();l.boundaryToBlock();var m=l.startContainer;if(l.startContainer!=b.domUtil.body){l.setStart(h,i),l.endContainer!=b.domUtil.body&&l.setEndAfter(l.endContainer);var n=l.extractContents(),o=n.firstChild,p=e.firstChild;if(b.domUtil.isBlock(m)&&p)if(b.domUtil.isBlock(p)){for(;p.firstChild;)f=p.firstChild,m.appendChild(p.firstChild);b.domUtil.remove(p)}else f=p,m.appendChild(p);if(o&&e.lastChild)o.firstChild?(3==e.lastChild.nodeType&&(f=e.lastChild,j=!0,o.insertBefore(e.lastChild,o.firstChild),e.appendChild(o)),1==e.lastChild.nodeType&&(b.domUtil.isBlock(e.lastChild)?f=e.lastChild.lastChild||e.lastChild:(f=e.lastChild,o.insertBefore(e.lastChild,o.firstChild)),j=!0,e.appendChild(o))):n.removeChild(o),c.setStartAfter(m),c.collapse(!0);else for(;n.firstChild&&n.firstChild.firstChild;)f=n.firstChild.firstChild,m.appendChild(n.firstChild.firstChild)}for(;e.lastChild;)if(1==e.lastChild.nodeType||3==e.lastChild.nodeType){j||(f=e.lastChild);var q=e.lastChild;g.firstChild?g.insertBefore(q,g.firstChild):g.appendChild(q)}else b.domUtil.remove(e.lastChild);c.insertNode(g),c.setStartAfter(f),c.collapse(!0),c.select(!0),b.fire("afterpaste",c),b.fire("saveUndo",!c.collapsed,!0)}else{var r=e.textContent||e.innerText;if(r){var s=b.doc.createTextNode(r);c.insertNode(s),c.setStartAfter(s),c.select(!0)}}}var d=SinaEditor,e=d.Util,f=d.env;a=e.extend({getType:function(a){return"text/html"}},a),b.ready(function(){var a,d=b.domUtil,g=new SinaEditor.FilterHTML(d);b.on("paste",function(h,i){try{if(a)return void i.preventDefault();var j=b.getRange(!0),k=j.createBookMark("pasteBin"),l=b.doc.createElement("div");if(a="pasteBin_"+ +new Date,l.id=a,f.$webkit){var m=b.doc.createTextNode("​​");l.appendChild(m)}if(d.body.appendChild(l),j.setStart(l,0),k.start.style.display="",l.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;z-index:-9999",f.$msie&&f.version<=10){for(var n=window.clipboardData.getData("text"),o=n.split(/[\n|\r]/g),m="";;){var m=o.shift();if(void 0===m)break;m=e.trim(m),""!=m&&(l.innerHTML+="<p>"+m+"</p>")}i.preventDefault()}f.$webkit?j.setEnd(l,1):j.collapse(!0),j.select(!0),b.fire("beforepaste"),window.setTimeout(function(){var e=b.doc.getElementById(a);if(e){d.remove(e);var f=g.pasteHtml(e);a=null;try{j.moveToBookMark("pasteBin"),c(j,f)}catch(h){}e=null}},0)}catch(p){i.preventDefault()}})})}),function(a){function b(a){var b={ctrl:1,alt:2,shift:3},c=a.toLowerCase().split(/\s*\+\s*/g);c.sort(function(a,c){return b[a]&&b[c]?b[a]>b[c]?1:b[a]<b[c]?-1:0:0});var d=c[c.length-1];return f[d]&&(c[c.length-1]=f[d]),c.join("+")}function c(a,b){var c=this,e=[];c.hashKeys={},c.options=d.extend({keylist:[{exec:"bold",params:null,hotkeys:["ctrl+alt+66","ctrl+66"]}]},a),e=c.options.keylist,c.registerHotkey(e),b.on("ready",function(){c.clickInit()})}for(var d=a.Util,e=a.VK,f={},g=0;9>=g;g++)f[g]=48+g;g=97;for(var h=123;h>g;g++)f[String.fromCharCode(65+g-97)]=65+g-97,f[String.fromCharCode(g)]=65+g-97;c.prototype.getExecByEvent=function(a){var b=this,c=b.hashKeys,d="",e=a.keyCode||a.which;return(a.ctrlKey||SinaEditor.env.mac&&a.metaKey)&&(d+="ctrl+"),a.altKey&&(d+="alt+"),a.shiftKey&&(d+="shift+"),d+=f[e]||e,c[d]||null},c.prototype.clickInit=function(){var a=this;editor.on("keydown",function(b,c){if(e.modifierPressed(c)||e.metaKeyPressed(c)){var d=a.getExecByEvent(c);if(d){c.preventDefault();var f="function"==typeof d.exec?d.exec.call(editor):d.exec;if(f&&"string"==typeof f){var g="function"==typeof d.params?d.params.call(editor):d.params;editor.exec(f,g)}}}})},c.prototype.registerHotkey=function(a){var c=this;d.isArray(a)||(a=[a]);for(var e=0;e<a.length;e++){var f=a[e].hotkeys;if("string"==typeof f)c.hashKeys[b(f)]=a[e];else if(d.isArray(f))for(var g=0;g<f.length;g++)c.hashKeys[b(f[g])]=a[e]}},a.PluginManager.register("hotkey",c)}(SinaEditor),SinaEditor.PluginManager.register("link",function(a,b){b.registerCmd("link",{queryCommandState:function(a,c,d){var e=!1;return b.domUtil.each(d,function(a,b){return"A"===b.nodeName.toUpperCase()?(e=!0,!1):void 0}),e},exec:function(a,c){var d=b.getRange(),e=d.getCommonAncestor();3==e.nodeType&&(e=e.parentNode),0!==b.domUtil.$("a",e).length&&d.removeInlineTag("a"),d.insertInlineTag("a",{href:c.url,target:"_blank"})}}),b.registerCmd("unlink",{exec:function(a){var c=b.getRange();c.removeInlineTag("a")}})}),function(){SinaEditor.PluginManager.register("linkBtn",function(a,b){function c(){b.exec("unlink")}function d(a){0!==a.indexOf("http://")&&(a="http://"+a),b.exec("link",{url:a})}function e(a,b){var c=o.attr(a,"placeholder");o.on(a,"keydown mousedown",function(a){a=o.fixEvent(a);var b=a.target;c==n.trim(b.value)&&(b.value="")}),o.on(a,"blur",function(a){a=o.fixEvent(a);var b=a.target;""==n.trim(b.value)&&(b.value=c)}),o.on(a,"keyup",function(a){a=o.fixEvent(a);var c=a.target,e=b.getNode("add"),f=n.trim(c.value);f?(o.text(e,"添加"),m.ENTER===a.keyCode&&(d(f),c.value="",p.hide())):o.text(e,"返回")})}function f(a,b){o.on(a,"click",function(a){a=o.fixEvent(a);var c=n.trim(b.value);c&&d(c),p.hide(),a.preventDefault()})}function g(a,b){var c=a.getPos(),d=null,g=null;p?(p.show(c),d=p.getNode("address")):(p=new l({html:b}),p.show(c),d=p.getNode("address"),g=p.getNode("add"),e(d,p),f(g,d));var h=o.attr(d,"placeholder");9>k.version&&k.msie?d.value=h:d.value=""}function h(){var a=['<div id="#{panel}" class="BNE_editor_color BNE_editor_color1 BNE_editor_cur" style="z-index:301;position:absolute;">','<input placeholder="请输入链接地址" id="#{address}" class="input_link" type="text">','<a class="add_link" href="javascript:void(0)" title="" id="#{add}">返回</a>','<i class="arrow-down"></i>',"</div>"].join("");b.on("toolbar.linkbtn.click",function(b,d){var e=d.getButton("linkBtn");e.actived?c():g(d,a)}),b.on("toolbar.selectionchange",function(a,c,d,e){var f=b.queryCommandState("link",c,d),g=e.getButton("linkBtn");f?g.active():g.normal()}),b.on("selectionchange",function(){p&&p.hide()})}var i=SinaEditor,j=i.DOMUtil,k=i.env,l=i.ui.Layer,m=i.VK,n=i.Util,o=new j,p=null;return h(),{toolBars:[{id:"link",name:"linkBtn",exec:"link unlink",tooltip:"加链接",activeCls:"hovered"}]}})}(),SinaEditor.PluginManager.register("widget",function(a,b){function c(a){var c=f.attr(a,"se-widget");return c&&!f.contains(a,b.body)?a:void 0}function d(a){var c=f.create("p",{},g.$webkit?"<br/>":"");f.insertAfter(c,a);var d=b.selection.createRange();d.setStart(c,0),d.collapse(!0),d.select()}var e=SinaEditor,f=b.domUtil,g=(e.spaceChar,e.env),h=e.VK,i=e.Util;b.on("beforeenter",function(a,c){var e=b.domUtil.fixEvent(c),g=e.target,j=e.keyCode||e.which,k=j==h.ENTER,l=!0;if(k){var m=f.parents(g,!0);i.each(m,function(a,b){return f.attr(b,"se-widget")?(l=!1,!1):void 0}),!1===l&&d(m[m.length-1])}return l}),b.on("beforedelete",function(a,d){var e,g,i,j,k,l,m=-1,n=b.getRange(),o=f.getStart(n);3==o.nodeType&&(o=o.parentNode),m=n.startOffset;var p=function(a,c,d){return d=d||3,i=f.treeWalker(a,b.body,function(a){return d!==a.nodeType?!1:void 0}),i[c]()},q=function(a){if(!a.collapsed)return!1;var c=a.startContainer,d=a.startOffset;if(!f.contains(b.body,c))return!1;if(1==c.nodeType&&c===b.body)return d===c.childNodes.length;if(3===c.nodeType){if(d!==c.nodeValue.length)return!1;c=c.parentNode}for(var e;c&&c!==b.body;){if(e=c.parentNode==b.body)return!0;if(!e&&c.nextSibling)return!1;c=c.parentNode}return!1};if(0==m&&h.BACKSPACE==d.keyCode)l=p(o,"prev",1),l&&(g=c(l));else if(h.DELETE==d.keyCode){if(!q(n))return;k=p(o,"next",1),k&&(g=c(k))}else g=c(o);if((!n.collapsed||g)&&(g||(j=f.getEnd(n),3==j.nodeType&&(j=j.parentNode),g=c(j)),g)){if(e=j||o,!n.collapsed||!c(e))return n.collapsed?(b.fire("saveUndo"),f.remove(g),b.fire("saveUndo"),!1):void(j?n.setEndAfter(g):n.setStartBefore(g));if(!f.text(e)||!m)return!1}})}),SinaEditor.PluginManager.register("music",function(a,b){function c(a,b){var c="http://simg.sinajs.cn/blog7style/images/common/editor/musicplayer.png",d=g.create("img",{"se-holder":1,src:c,songlist:a,autoplay:b,playerid:"musicplayer_"+f.uniqueId(!1),"user-select":"none",style:{overflow:"hidden",textAlign:"center"}}),e=g.create("div",{"se-holder":1,"se-widget":"music",unselectable:"on",contenteditable:!1,style:{overflow:"hidden",textAlign:"center","padding-bottom":"28px"}});return e.appendChild(d),e}function d(){var a=g.create("p",{innerHTML:SinaEditor.env.$webkit?'<br se-holder="1">':""});return a}var e=SinaEditor,f=e.Util,g=b.domUtil;b.registerCmd("insertMusic",{queryCommandState:function(a,c,d){var e=!1;return b.domUtil.each(d,function(a,b){return"A"===b.nodeName.toUpperCase()?(e=!0,!1):void 0}),e},exec:function(a,e){var f,h=[];g.each(e.musicList,function(a,b){h.push(decodeURIComponent(b))}),f=h.join("|");var i=c(f,e.autoPlay),j=b.getRange(),k=g.getStart(j),l=g.parents(k,!0),m=l.pop(),n=b.body;m&&1!=m.nodeType&&(m=null);var o=j.startContainer,p=j.startOffset;if(j.collapsed&&o==n&&0==p||!m||m==n){n.appendChild(i);var q=d();g.insertNode(q,n,"beforeend"),j.setStart(q,0)}else{j.setEndAfter(m);var r=m.nextSibling,s=m.previousSibling,t=m.parentNode,u=j.extractContents();1!==m.parentNode?r?g.insertBefore(i,r):s?g.insertAfter(i,s):g.append(i,t):g.insertAfter(i,m);var v=u&&u.firstChild;if(v)g.insertAfter(u,i),j.setStart(v,0);else if(g.insertAfter(u,i),v)g.insertAfter(u,i),j.setStart(v,0);else{var q=d();g.insertAfter(q,i),j.setStart(q,0)}}j.collapse(!0),j.select(!0)}})}),SinaEditor.PluginManager.register("musicBtn",function(a,b){function c(a){var b=a.getNode("error");b.style.display=""}function d(a){var b=a.getNode("error");b.style.display="none"}function e(a){var b=n.urlParser(a),c=b.pathname;return c&&/\/[^\/]+\.mp3$/i.test(c)?!0:!1}function f(a){return-1!==q.indexOf(a)}function g(a,b,g,h){if(!b)return void c(h);if(0!==b.indexOf("http://")&&(b="http://"+b),!e(b))return void c(h);if(d(h),a.value="",!f(b)){q.push(b);var i=p.create("li",{address:encodeURIComponent(b)},['<span class="music_chosen">',b,"</span>",'<a class="music_close" title="关闭" href="javascript:void(0)">×</a>'].join(""));g.appendChild(i)}}function h(a){var f=a.getNode("mp3Address"),h=a.getNode("mp3OK"),i=(a.getNode("autoPlay"),a.getNode("insert")),j=a.getNode("musicSelect");p.on(f,"keyup",function(b){var h=n.trim(f.value);b.keyCode===l.ENTER?g(f,h,j,a):h&&!e(h)?c(a):d(a)}),p.on(h,"click",function(b){var c=n.trim(f.value);g(f,c,j,a)}),p.on(i,"click",function(c){var d=a.getNode("autoPlay").checked?1:0;return 0==q.length?void new o({type:"alert",text:"抱歉，您还没有选择音乐，请至少选择一首。"}):(a.hide(),b.exec("insertMusic",{musicList:q,autoPlay:d}),void(q=[]))}),p.on(j,"click",function(a){var b=a.target,c=b.parentNode,d=decodeURIComponent(p.attr(c,"address")),e=q.indexOf(d);-1!==e&&q.splice(e,1),p.remove(c)},!1,"a")}function i(a){function b(a){var b=a.getNode("musicSelect");b.innerHTML=""}p.on(p.$("#insert_music"),"click",function(){a||(a=new o({content:r,funcClose:function(a){q=[]},width:671,title:"插入音乐"},"insert_music"),h(a)),b(a),a.show(),a.setMiddle()},!1)}function j(){i()}var k=SinaEditor,l=k.VK,m=k.DOMUtil,n=k.Util,o=k.ui.WinBox,p=new m,q=(b.domUtil,[]),r=['<div class="e_layer_cont2">','<form action="add" onsubmit="return false;" name="addWebMusic">','<dl class="e_layer_music">','<dt class="md">音乐地址：</dt>',"<dd>",'<div class="music_input">','<input id="#{mp3Address}" style="width:96%;padding-left:10px;" maxlength="255" placeholder="请输入音乐地址（http://）,支持MP3格式" class="tag_input" type="text"/>',"</div>",'<a id="#{mp3OK}" href="javascript:void(0)" class="music_btn btn_style">确定</a>',"</dd>","</dl>",'<p class="music_warn" style="display:none;" id="#{error}">音乐地址要求必须为http地址且为mp3格式，请重新输入！</p>','<dl class="e_layer_music">',"<dt>已选歌曲：</dt>","<dd>",'<ul id="#{musicSelect}" class="music_select"></ul>',"</dd>","</dl>",'<p class="mp"><input id="#{autoPlay}" type="checkbox" class="music_box"/><label for="#{autoPlay}">本博文自动音乐播放</label></p>','<a id="#{insert}" href="javascript:void(0)" class="music_btn m_btn btn_style">插入音乐</a>',"</form>","</div>"].join("");j()}),SinaEditor.PluginManager.register("suda",function(a,b){var c=a.cmds||{bold:"16_01_01",italic:"16_01_02",underline:"16_01_03",title:{h1:"16_01_04",h2:"16_01_05"},justify:{left:"16_01_06",center:"16_01_07",right:"16_01_08"},link:"16_01_09",unlink:"16_01_09",color:"16_01_10",resetcolor:"16_01_10"};b.ready(function(){b.on("execcommand",function(a,b){var d=c[b.cmdName];d&&("string"!=typeof d&&(d=d[b.data]),d&&window.v7sendLog&&v7sendLog(d))})})});