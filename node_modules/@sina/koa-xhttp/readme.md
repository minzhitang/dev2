# koa-xhttp

##### 该模块依赖`request`

``` json
"request": "^2.67.0"
```


http请求

- 默认开启跟踪 `30X` 跳转，默认跟踪 `2` 次
- 默认关闭非 `30X` 跳转跟踪
- 默认开启 `gzip` 压缩
- 默认超时 `3` 秒





##### 配置

``` javascript
初始化
var xhttp = require('@sina/koa-xhttp');

使用
this.body = yield xhttp.get( url );
this.body = yield xhttp.auth( url, 'user', 'pwd' );
this.body = yield xhttp.post( url, {name:'xxxx'} );
this.body = yield xhttp.upload( url, {name:'xxxx', 'file': fs.createReadStream('./arr.png')} );
this.body = yield xhttp.download( url );
```



##### 接口

`get( url, header, cookies, timeout, redo )`

> GET 请求
> 
> 参数：
> 
> > url : string 请求地址
> > 
> > header : obj 自定义header
> > 
> > cookies : obj  cookie
> > 
> > timeout: 超时时间，默认3秒
> > 
> > redo: 失败重试次数，默认0，暂时不可用





`auth( url, user, password, header, cookies, timeout, redo )`

> HTTP Authentication
> 
> 参数：
> 
> > url : string 请求地址
> > 
> > user： string auth  user
> > 
> > password : string auth password
> > 
> > header : obj 自定义header
> > 
> > cookies : obj  cookie
> > 
> > timeout: 超时时间，默认3秒
> > 
> > redo: 失败重试次数，默认0，暂时不可用





`post( url, data, header, cookies, timeout, redo )`

> POST请求
> 
> 参数：
> 
> > url : string 请求地址
> > 
> > data: obj  要提交的数据
> > 
> > header : obj 自定义header
> > 
> > cookies : obj  cookie
> > 
> > timeout: 超时时间，默认3秒
> > 
> > redo: 失败重试次数，默认0，暂时不可用







`upload( url, data, header, cookies, timeout, redo )`

> 上传文件
> 
> 参数：
> 
> > url : string 请求地址
> > 
> > data: obj  要提交的数据，可以同时提交数据和上传文件
> > 
> > header : obj 自定义header
> > 
> > cookies : obj  cookie
> > 
> > timeout: 超时时间，默认3秒
> > 
> > redo: 失败重试次数，默认0，暂时不可用







`download( downUrl, targetDir, targetName )`

> 下载文件
> 
> 参数：
> 
> > downUrl : string 请求地址
> > 
> > targetDir： string 保存目录，支持自动创建文件夹（777），为空的时候保存在当前目录
> > 
> > targetName : string 保存名称，为空的时候取下载文件的文件名









