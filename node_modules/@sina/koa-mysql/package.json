{
  "name": "@sina/koa-mysql",
  "version": "0.1.21",
  "description": "sina mysql with koa",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [
    "sina",
    "koa",
    "mysql"
  ],
  "author": {
    "name": "wangkun5"
  },
  "license": "ISC",
  "dependencies": {
    "co-mysql": "^1.0.0",
    "mysql": "^2.10.0"
  },
  "readme": "# koa-mysql\n\n##### 该模块依赖`mysql`，`co-mysql`，\n\n``` json\n\"co-mysql\": \"1.0.0\",\n\"mysql\": \"2.10.0\"\n```\n\n所有操作为链式操作，支持分表，支持主从。其中 `insert`，`update`，`delete` 强制主库操作，`select`支持强制主库查询。\n\n\n\n\n\n##### 配置\n\n``` javascript\n配置\n  exports.dbConfig = {\n      debug : false,    // 为TRUE时，会把执行的sql在控制台输出\n      master : {\n          host : 'localhost',\n          port : 3306 ,\n          database : 'database',\n          user: 'root',\n          password : 'root',\n          connectionLimit: 10, // 数据库操作为连接池操作，主库最大连接数根据实际情况设置\n          connectTimeout : 150, // 连接超时，单位milliseconds\n      },\n      slave : {\n          host : 'localhost',\n          port : 3306 ,\n          database : 'database',\n          user: 'root',\n          password : 'root',\n          connectionLimit: 50, // 数据库操作为连接池操作，从库最大连接数根据实际情况设置\n          connectTimeout : 150, // 连接超时，单位milliseconds\n      }\n  }\n\n初始化\n    var mysql = require('@sina/koa-mysql');\n    var dbConfig = require('./config').dbConfig;\n\n    module.exports = function ( tableName, tableId ){\n        mysqlObj = new mysql( dbConfig, tableName, tableId );\n        return mysqlObj;\n    }\n\n使用\n    var userDb = require('../config/mysql')('user');\n    userDb.select().one();\n```\n\n\n\n##### 接口\n\n`select(field)`\n\n> 设置查询的字段\n> \n> 参数：\n> \n> > field : string 要查询的字段\n> \n> 返回值：本身\n\n\n\n`where(obj)`\n\n> 设置查询条件\n> \n> 参数：\n> \n> > obj: object 查询条件，注意格式\n> > \n> > ​        { id : 1 }\n> > \n> > ​        { name : { sign: '>/>=/</<=', val: 2 } }\n> > \n> > ​        { name : { sign: 'like', val: '%小明%' } \n> > \n> > ​        { id : { sign: 'in', val: [1,2] } \n> \n> 返回值：本身\n\n\n\n`group(group)`\n\n> 设置分组条件\n> \n> 参数：\n> \n> > group: string 分组条件\n> \n> 返回值：本身\n\n\n\n`orderBy(orderObj)`\n\n> 设置排序条件\n> \n> 参数：\n> \n> > orderObj : Object 排序条件\n> > \n> \n> 返回值：本身\n\n\n\n`limit(page, pageSize)`\n\n> 设置分页条件\n> \n> 参数：\n> \n> > page : number 页码，默认为1\n> > \n> > pageSize：分页尺寸，默认为20\n> \n> 返回值：本身\n\n\n\n`one(master_or_slave)`\n\n> 获取一条记录\n> \n> 参数：\n> \n> > master_or_slave: string 主从\n> \n> 返回值：object\n\n\n\n`all(master_or_slave)`\n\n> 获取多条记录  \n> \n> 参数：\n> \n> > master_or_slave: string 主从\n> \n> 返回值：object\n\n\n\n`first(master_or_slave)`\n\n> 获取一条数据的一个字段的值, 多个查询字段只返回第一个字段的值，参数为 * 的时候抛出错误\n> \n> 参数：\n> \n> > master_or_slave: string 主从\n> \n> 返回值：string\n\n``` javascript\nvar rs = yield db.select().where({id:1}).one();\n\nvar rs = yield db.select('name,city').where({city:{sign:'>',val:20}}).orderBy('id').all('master');\n```\n\n\n\n`insert( insertObj )`\n\n> 插入数据\n> \n> 强制主库操作\n> \n> 参数：\n> \n> > insertObj : object 要插入的数据\n> \n> 返回值：Number 插入数据的id\n\n``` \nvar id = yield db.insert( {name:'小明',age:20,city:'北京'} );\n```\n\n\n\n`delete( whereObj )`\n\n> 删除数据\n> \n> 强制主库操作\n> \n> 参数：\n> \n> > whereObj : object 删除的条件，格式和`where`函数一样\n> \n> 返回值：Number 删除数据的行数\n\n``` javascript\nvar num = yield db.delete( {name:'小明'} );\n```\n\n\n\n`update( updateObj, whereObj )`\n\n> 更新数据\n> \n> 强制主库操作\n> \n> 参数：\n> \n> > updateObj : object 要更新的数据\n> > \n> > whereObj : object 更新的条件，格式和`where`函数一样\n> \n> 返回值：Number \b影响行数\n\n``` javascript\nvar num = yield db.update( {name:'小明2'}, {id:1} );\n```\n\n\n\n`query( sql, master_or_slave )`\n\n> 手动执行sql\n> \n> 参数：\n> \n> > sql : string 要执行的sql\n> > \n> > master_or_slave : string 主从\n> \n> 返回值：object \n\n``` javascript\nvar rs = yield db.query('select version()');\n```\n\n\n\n`getSql`\n\n> 获取刚运行的sql\n> \n> 返回值：string 刚才运行的sql语句\n\n``` javascript\nvar sql = yield db.getSql();\n```\n\n\n\n`getCountNum(master_or_slave)`\n\n> 获取结果集的行数，在有查询条件的情况下，获取该查询条件下的总行数，没有的时候获取该表的总数目\n> \n> 返回值：Number 返回上次查询的结果集行数\n\n``` javascript\nvar countNum = yield db.getCountNum();\n```\n\n​",
  "readmeFilename": "readme.md",
  "_id": "@sina/koa-mysql@0.1.21",
  "_shasum": "1caebf97522773afb5dc698150bd48b5d1903252",
  "_from": "@sina/koa-mysql@0.1.21"
}
